# v3.2 éƒ¨ç½²æ£€æŸ¥æ¸…å•

## ğŸ“‹ è„šæœ¬å®‰è£…å‰æ£€æŸ¥

- [ ] ç³»ç»Ÿæ˜¯ Rocky Linux 9.4 æˆ–æ›´æ–°ç‰ˆ
- [ ] å…·æœ‰ root æˆ– sudo æƒé™
- [ ] ç½‘ç»œè¿æ¥æ­£å¸¸
- [ ] ç£ç›˜ç©ºé—´å……è¶³ (è‡³å°‘ 2GB)
- [ ] å·²å®‰è£… jq (åº”è¯¥ç”±å‰ç½®æ­¥éª¤å®‰è£…)

## ğŸ”§ å®‰è£…æ­¥éª¤

### æ­¥éª¤ 1: å‡†å¤‡

```bash
# æ£€æŸ¥ç³»ç»Ÿä¿¡æ¯
cat /etc/os-release

# æ£€æŸ¥ jq æ˜¯å¦å·²å®‰è£…
jq --version

# å¤‡ä»½ç°æœ‰é…ç½®ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
cp -r /opt/actions-runner/compat-scripts /tmp/compat-scripts.backup 2>/dev/null
```

- [ ] ç³»ç»Ÿç‰ˆæœ¬ç¡®è®¤
- [ ] jq å·²å®‰è£…
- [ ] å¤‡ä»½å®Œæˆ

### æ­¥éª¤ 2: è¿è¡Œè„šæœ¬

```bash
# ä¸‹è½½è„šæœ¬åˆ°é™„å½•ç›®å½•
cd /path/to/é™„å½•

# ä»¥ root æƒé™è¿è¡Œ
sudo bash setup-rocky-9.4-ci-env-v3.2.sh
```

- [ ] è„šæœ¬æ‰§è¡Œæ— é”™è¯¯
- [ ] æ‰€æœ‰å·¥å…·æˆåŠŸå®‰è£…
- [ ] ä»“åº“é…ç½®å®Œæˆ

### æ­¥éª¤ 3: éªŒè¯å®‰è£…

```bash
# 1. æ£€æŸ¥ apt-get å¯ç”¨æ€§
which apt-get
apt-get --version

# 2. æŸ¥çœ‹è‡ªåŠ¨ç”Ÿæˆçš„ JSON é…ç½®
ls -la /opt/actions-runner/compat-scripts/

# 3. éªŒè¯ JSON æ ¼å¼
jq . /opt/actions-runner/compat-scripts/package-map.json
jq . /opt/actions-runner/compat-scripts/ignore-packages.json

# 4. æ˜¾ç¤º wrapper é…ç½®ä¿¡æ¯
apt-get config-info
```

- [ ] apt-get å‘½ä»¤å¯ç”¨
- [ ] JSON æ–‡ä»¶å·²åˆ›å»º
- [ ] JSON æ ¼å¼æœ‰æ•ˆ
- [ ] wrapper é…ç½®æ˜¾ç¤ºæ­£å¸¸

## ğŸ§ª åŠŸèƒ½æµ‹è¯•

### æµ‹è¯• 1: åŸºç¡€å‘½ä»¤

```bash
# æµ‹è¯• update
apt-get update

# æµ‹è¯• help
apt-get --version

# æµ‹è¯• config info
apt-get config-info
```

- [ ] `apt-get update` æˆåŠŸ
- [ ] `apt-get --version` æ˜¾ç¤º wrapper ç‰ˆæœ¬
- [ ] `apt-get config-info` æ˜¾ç¤ºé…ç½®

### æµ‹è¯• 2: åŒ…åè½¬æ¢

```bash
# æµ‹è¯•æ˜ å°„è¡¨ä¸­çš„åŒ…
apt-get install -y fuse3-devel  # ç›´æ¥å®‰è£…ï¼ˆæ— éœ€è½¬æ¢ï¼‰
apt-get remove fuse3-devel

# è¿™ä¸ªå‘½ä»¤æœ¬æ¥åº”è¯¥å¤±è´¥ï¼Œä½† wrapper ä¼šè½¬æ¢:
# apt-get install -y libfuse-dev
#   â†“
# dnf install -y fuse3-devel
```

- [ ] æ–‡ä»¶ç³»ç»Ÿç›¸å…³çš„åŒ…èƒ½è¢«å®‰è£…

### æµ‹è¯• 3: å¿½ç•¥åˆ—è¡¨

```bash
# æµ‹è¯•è¢«å¿½ç•¥çš„åŒ…ï¼ˆåº”è¯¥è·³è¿‡ï¼Œä¸æŠ¥é”™ï¼‰
apt-get install -y git-annex
# è¾“å‡ºåº”è¯¥æ— ä»»ä½•é”™è¯¯æˆ–å°è¯•å®‰è£…

# éªŒè¯ï¼š
apt-get config-info | grep "git-annex"
```

- [ ] å¿½ç•¥çš„åŒ…ä¸ä¼šè¢«å®‰è£…
- [ ] å‘½ä»¤ä¸æŠ¥é”™

### æµ‹è¯• 4: GitHub Actions æ¨¡æ‹Ÿ

```bash
# åˆ›å»ºä¸´æ—¶è„šæœ¬æ¨¡æ‹Ÿ GitHub Actions
cat > /tmp/test-workflow.sh << 'EOF'
#!/bin/bash
set -e
echo "=== Test GitHub Actions Workflow ==="
apt-get update
apt-get install -y pkg-config
echo "=== Test Successful ==="
EOF

chmod +x /tmp/test-workflow.sh
bash /tmp/test-workflow.sh
```

- [ ] æ¨¡æ‹Ÿçš„å·¥ä½œæµæˆåŠŸæ‰§è¡Œ

## ğŸ“Š é…ç½®éªŒè¯

### æ˜ å°„è¡¨æ£€æŸ¥

```bash
# æŸ¥çœ‹æ‰€æœ‰æ˜ å°„
jq 'to_entries[] | select(.key | startswith("_") | not) | "\(.key) â†’ \(.value)"' \
  /opt/actions-runner/compat-scripts/package-map.json

# éªŒè¯å…³é”®æ˜ å°„å­˜åœ¨
jq -r '.libfuse_dev' /opt/actions-runner/compat-scripts/package-map.json | grep -q fuse3-devel
jq -r '.nfs_common' /opt/actions-runner/compat-scripts/package-map.json | grep -q nfs-utils
```

- [ ] æ‰€æœ‰é»˜è®¤æ˜ å°„å­˜åœ¨
- [ ] libfuse-dev æ˜ å°„åˆ° fuse3-devel
- [ ] nfs-common æ˜ å°„åˆ° nfs-utils

### å¿½ç•¥åˆ—è¡¨æ£€æŸ¥

```bash
# æŸ¥çœ‹æ‰€æœ‰å¿½ç•¥åŒ…
jq '.ignore[]' /opt/actions-runner/compat-scripts/ignore-packages.json

# éªŒè¯å…³é”®åŒ…åœ¨åˆ—è¡¨ä¸­
jq -r '.ignore[]' /opt/actions-runner/compat-scripts/ignore-packages.json | grep -q git-annex
```

- [ ] git-annex åœ¨å¿½ç•¥åˆ—è¡¨ä¸­
- [ ] git-annex-remote-rclone åœ¨å¿½ç•¥åˆ—è¡¨ä¸­

## ğŸ” æƒé™æ£€æŸ¥

```bash
# æ£€æŸ¥ apt-get wrapper æƒé™
ls -la /opt/actions-runner/compat-scripts/apt-get
# åº”è¯¥æ˜¾ç¤º: -rwxr-xr-x

# æ£€æŸ¥è½¯é“¾æ¥
ls -la /usr/bin/apt-get
ls -la /usr/local/bin/apt-get
# éƒ½åº”è¯¥æŒ‡å‘ /opt/actions-runner/compat-scripts/apt-get

# æ£€æŸ¥ runner ç”¨æˆ·æƒé™
sudo -l runner | grep -i apt || echo "æ²¡æœ‰ç‰¹æ®Šçš„ apt æƒé™é…ç½®"
```

- [ ] wrapper è„šæœ¬å¯æ‰§è¡Œ
- [ ] /usr/bin/apt-get è½¯é“¾æ¥æ­£ç¡®
- [ ] /usr/local/bin/apt-get è½¯é“¾æ¥æ­£ç¡®
- [ ] runner ç”¨æˆ·æœ‰ sudo æƒé™

## ğŸ§‘â€ğŸ’¼ ç»´æŠ¤äººå‘˜æ£€æŸ¥

### é…ç½®å¯ç»´æŠ¤æ€§

```bash
# éªŒè¯é…ç½®æ–‡ä»¶æ˜“äºç¼–è¾‘
# 1. æ‰“å¼€æ˜ å°„è¡¨æŸ¥çœ‹
nano /opt/actions-runner/compat-scripts/package-map.json

# 2. å°è¯•æ·»åŠ æ–°æ˜ å°„ï¼ˆæ— éœ€ä¿å­˜ï¼‰
# 3. éªŒè¯ jq èƒ½è§£æä¿®æ”¹åçš„ç‰ˆæœ¬

# éªŒè¯å¿½ç•¥åˆ—è¡¨æ˜“äºç¼–è¾‘
nano /opt/actions-runner/compat-scripts/ignore-packages.json
```

- [ ] JSON é…ç½®æ˜“äºé˜…è¯»
- [ ] é…ç½®æ ¼å¼æ¸…æ™°
- [ ] æœ‰è¶³å¤Ÿçš„æ³¨é‡Šè¯´æ˜

### å‡çº§è·¯å¾„æ£€æŸ¥

```bash
# æ£€æŸ¥å¤‡ä»½æœºåˆ¶
ls -la /opt/actions-runner/compat-scripts/*.bak 2>/dev/null || echo "æœªæ£€æµ‹åˆ°å¤‡ä»½"

# å†æ¬¡è¿è¡Œè„šæœ¬æŸ¥çœ‹ç‰ˆæœ¬æ£€æµ‹
# sudo bash setup-rocky-9.4-ci-env-v3.2.sh
# åº”è¯¥è¾“å‡ºï¼šé…ç½®æ–‡ä»¶å·²å­˜åœ¨ä¸”ç‰ˆæœ¬ä¸€è‡´ï¼Œæ— éœ€æ›´æ–°
```

- [ ] å¤‡ä»½æ–‡ä»¶æœºåˆ¶å®Œæ•´
- [ ] ç‰ˆæœ¬æ£€æµ‹å·¥ä½œæ­£å¸¸

## ğŸ“š æ–‡æ¡£æ£€æŸ¥

```bash
# éªŒè¯æ‰€æœ‰æ–‡æ¡£å·²ç”Ÿæˆ
ls -1 é™„å½•/*.md

# åº”è¯¥åŒ…å«ï¼š
# - README-v3.2.md (ä¸»è¯´æ˜)
# - å¿«é€Ÿå‚è€ƒ-JSONé…ç½®.md (é€ŸæŸ¥è¡¨)
# - JSONé…ç½®ç»´æŠ¤æŒ‡å—-v3.2.md (è¯¦ç»†æŒ‡å—)
# - v3.2å˜æ›´æ—¥å¿—.md (ç‰ˆæœ¬è¯´æ˜)
```

- [ ] README-v3.2.md å­˜åœ¨
- [ ] å¿«é€Ÿå‚è€ƒæ–‡æ¡£å­˜åœ¨
- [ ] ç»´æŠ¤æŒ‡å—å­˜åœ¨
- [ ] å˜æ›´æ—¥å¿—å­˜åœ¨
- [ ] ç¤ºä¾‹æ–‡ä»¶å­˜åœ¨

## ğŸš€ ç”Ÿäº§ç¯å¢ƒå‡†å¤‡

### åœ¨å®é™…æµ‹è¯•ä¹‹å‰

```bash
# 1. å®Œæ•´å¤‡ä»½ç³»ç»Ÿé…ç½®
tar czf /tmp/system-backup.tar.gz /opt/actions-runner/

# 2. åœæ­¢æ‰€æœ‰è¿è¡Œä¸­çš„ä»»åŠ¡
systemctl stop actions.runner* 2>/dev/null || echo "No runner service to stop"

# 3. è¿è¡Œè„šæœ¬
sudo bash setup-rocky-9.4-ci-env-v3.2.sh

# 4. éªŒè¯å®‰è£…ï¼ˆè§ä¸Šé¢çš„æµ‹è¯•éƒ¨åˆ†ï¼‰

# 5. é‡å¯ runner æœåŠ¡
systemctl start actions.runner* 2>/dev/null || echo "Runner service restarted"
```

- [ ] ç³»ç»Ÿå¤‡ä»½å·²åˆ›å»º
- [ ] runner æœåŠ¡å·²åœæ­¢
- [ ] è„šæœ¬æ‰§è¡ŒæˆåŠŸ
- [ ] éªŒè¯æµ‹è¯•é€šè¿‡
- [ ] runner æœåŠ¡å·²é‡å¯

### GitHub Actions å·¥ä½œæµæµ‹è¯•

```bash
# 1. åœ¨ rclone é¡¹ç›®ä¸­è§¦å‘ CI/CD å·¥ä½œæµ
# 2. ç›‘æ§å·¥ä½œæµæ‰§è¡Œæ—¥å¿—
# 3. ç¡®è®¤ apt-get å‘½ä»¤æ­£å¸¸æ‰§è¡Œ
# 4. æ£€æŸ¥åŒ…æ˜¯å¦æ­£ç¡®è½¬æ¢
```

- [ ] GitHub Actions è§¦å‘æˆåŠŸ
- [ ] å·¥ä½œæµæ—¥å¿—æ˜¾ç¤º apt-get æ‰§è¡Œ
- [ ] ä¸è§åŒ…åè½¬æ¢çš„é”™è¯¯  
- [ ] æœ€ç»ˆå·¥ä½œæµæˆåŠŸ

## ğŸš¨ å¼‚å¸¸å¤„ç†æ¸…å•

å¦‚æœé‡åˆ°é—®é¢˜ï¼ŒæŒ‰é¡ºåºæ£€æŸ¥ï¼š

### 1. JSON æ ¼å¼é”™è¯¯

```bash
[ ] è¿è¡Œ: jq . /opt/actions-runner/compat-scripts/package-map.json
[ ] è¿è¡Œ: jq . /opt/actions-runner/compat-scripts/ignore-packages.json
[ ] æŸ¥çœ‹æ˜¯å¦æœ‰ "parse error"
[ ] æ¢å¤å¤‡ä»½: cp *.bak *.json
```

### 2. apt-get å‘½ä»¤ä¸æ‰¾

```bash
[ ] è¿è¡Œ: which apt-get
[ ] è¿è¡Œ: ls -la /usr/bin/apt-get
[ ] è¿è¡Œ: ls -la /usr/local/bin/apt-get
[ ] æ£€æŸ¥ PATH: echo $PATH
[ ] é‡æ–°åˆ›å»ºè½¯é“¾æ¥
```

### 3. åŒ…å®‰è£…å¤±è´¥

```bash
[ ] æ£€æŸ¥ dnf æ˜¯å¦å¯ç”¨: dnf --version
[ ] æ£€æŸ¥ä»“åº“é…ç½®: dnf repolist enabled
[ ] æŸ¥çœ‹ jq æ˜¯å¦å¯ç”¨: jq --version
[ ] æ£€æŸ¥æ˜ å°„è¡¨ä¸­æ˜¯å¦æœ‰å¯¹åº”åŒ…
```

### 4. wrapper è„šæœ¬é”™è¯¯

```bash
[ ] æ£€æŸ¥æ–‡ä»¶æƒé™: ls -la /opt/actions-runner/compat-scripts/apt-get
[ ] è¿è¡Œ: bash -n /opt/actions-runner/compat-scripts/apt-get
[ ] è°ƒè¯•æ¨¡å¼: bash -x /opt/actions-runner/compat-scripts/apt-get config-info
```

## âœ… æœ€ç»ˆæ£€æŸ¥

```bash
# æœ€ç»ˆéªŒè¯æ¸…å•
apt-get --version                           # wrapper ç‰ˆæœ¬
apt-get config-info                         # é…ç½®åŠ è½½
jq . /opt/actions-runner/compat-scripts/package-map.json    # æ˜ å°„è¡¨æœ‰æ•ˆ
jq . /opt/actions-runner/compat-scripts/ignore-packages.json # å¿½ç•¥åˆ—è¡¨æœ‰æ•ˆ
which apt-get                               # å‘½ä»¤å¯ç”¨
ls -la /usr/bin/apt-get                     # è½¯é“¾æ¥å­˜åœ¨
ls -la /usr/local/bin/apt-get               # è½¯é“¾æ¥å­˜åœ¨
```

æ‰€æœ‰æ£€æŸ¥é¡¹éƒ½æ ‡è®°ä¸º âœ… æ—¶ï¼Œéƒ¨ç½²å®Œæˆï¼

## ğŸ“ ç­¾ç½²

éƒ¨ç½²äººå‘˜: ____________________ æ—¥æœŸ: ____________________

éƒ¨ç½²å®¡æŸ¥: ____________________ æ—¥æœŸ: ____________________

---

**éƒ¨ç½²æ£€æŸ¥æ¸…å•ç‰ˆæœ¬**: 3.2  
**æœ€åæ›´æ–°**: 2026-02-20
