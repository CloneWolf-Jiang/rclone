# ğŸš€ v3.2+ è¡¥å……å…¼å®¹æ€§å®æ–½æ£€æŸ¥æ¸…å•

**å‘å¸ƒæ—¥æœŸ**: 2026-02-20  
**è¡¥å……ç‰ˆæœ¬**: v3.2+  
**ç›®çš„**: ç¡®ä¿è„šæœ¬ä¸ GitHub Actions workflows å®Œå…¨å…¼å®¹

## ğŸ“‹ è„šæœ¬è¡¥å……å†…å®¹æ£€æŸ¥

### âœ… å·²æ·»åŠ çš„åŠŸèƒ½

- [x] **verify-env è„šæœ¬** - éªŒè¯ç¯å¢ƒå®Œæ•´æ€§
  - æ£€æŸ¥æ‰€æœ‰å¿…éœ€åº“çš„å®‰è£…çŠ¶æ€
  - æ£€æŸ¥æ‰€æœ‰å¿…éœ€å·¥å…·çš„å¯ç”¨æ€§
  - éªŒè¯ apt-get wrapper çš„é…ç½®
  - éªŒè¯ JSON é…ç½®æ–‡ä»¶çš„æœ‰æ•ˆæ€§
  
- [x] **fix-env è„šæœ¬** - è‡ªåŠ¨ä¿®å¤ç¼ºå¤±çš„åº“
  - è¿è¡ŒéªŒè¯å™¨æ£€æŸ¥
  - è‡ªåŠ¨å®‰è£…ç¼ºå¤±çš„åº“
  - é‡æ–°éªŒè¯ä¿®å¤åçš„ç¯å¢ƒ

- [x] **ç¬¦å·é“¾æ¥** - ä¾¿äºç”¨æˆ·å¿«é€Ÿè°ƒç”¨
  - `/usr/local/bin/verify-rocky-ci-env`
  - `/usr/local/bin/fix-rocky-ci-env`

- [x] **å®Œæ•´çš„å‘½ä»¤è¾“å‡º** - æ˜¾ç¤ºæ–°å¢å‘½ä»¤çš„ä½¿ç”¨æ–¹æ³•

### æ ¸å¿ƒç¯å¢ƒæ£€æŸ¥é¡¹

verify-env æ£€æŸ¥çš„å†…å®¹ï¼š

```
âœ… åº“æ£€æŸ¥
   - fuse3-devel
   - pkgconf-pkg-config
   - nfs-utils
   - gcc / gcc-c++
   - python3-devel
   - openssl-devel
   - zlib-devel
   - ncurses-devel

âœ… å·¥å…·æ£€æŸ¥
   - gcc, g++, make
   - pkg-config, git, curl
   - jq, dnf, python3

âœ… apt-get wrapper æ£€æŸ¥
   - /usr/bin/apt-get å¯æ‰§è¡Œ
   - /usr/local/bin/apt-get å¯æ‰§è¡Œ

âœ… JSON é…ç½®æ£€æŸ¥
   - package-map.json æ ¼å¼æœ‰æ•ˆ
   - ignore-packages.json æ ¼å¼æœ‰æ•ˆ
   - é…ç½®é¡¹å®Œæ•´
```

## ğŸ“ å»ºè®®çš„ Workflow ä¿®æ”¹

### éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶

- [ ] `.github/workflows/build.yml` - æ”¹è¿›åº“å®‰è£…æ­¥éª¤

### ä¿®æ”¹å†…å®¹æ¦‚è§ˆ

#### æ–¹æ¡ˆ Aï¼šç¯å¢ƒéªŒè¯æ­¥éª¤ï¼ˆæ¨èå¿«é€Ÿæ–¹æ¡ˆï¼‰

åœ¨ "Install Go" ä¹‹åæ·»åŠ ï¼š

```yaml
- name: Verify Rocky Linux CI environment
  run: |
    if [[ -f /etc/os-release ]]; then
      . /etc/os-release
      if [[ "$ID" == "rocky" ]]; then
        verify-rocky-ci-env || fix-rocky-ci-env
      fi
    fi
  continue-on-error: true
  if: runner.os == 'Linux'
```

#### æ–¹æ¡ˆ Bï¼šæ”¹è¿›åº“å®‰è£…æ¡ä»¶ï¼ˆæ¨èå®Œæ•´æ–¹æ¡ˆï¼‰

æ›¿æ¢ç°æœ‰çš„ "Install Libraries on Linux" æ­¥éª¤ï¼ŒåŒºåˆ† Rocky å’Œ Ubuntuã€‚

è¯¦è§ [build.ymlä¿®æ”¹æŒ‡å—.md](build.ymlä¿®æ”¹æŒ‡å—.md)

### éœ€è¦ä¿®æ”¹çš„ Jobs

| Job | ä¿®æ”¹å¿…è¦æ€§ | ä¼˜å…ˆçº§ |
|-----|-----------|--------|
| build (linux) | âœ… å¿…éœ€ | ğŸ”´ é«˜ |
| build (linux_386) | âœ… å¿…éœ€ | ğŸ”´ é«˜ |
| build (other_os) | âœ… å¿…éœ€ | ğŸ”´ é«˜ |
| build (go1.24) | âœ… å¿…éœ€ | ğŸ”´ é«˜ |
| lint | âš ï¸ å¯é€‰ | ğŸŸ¡ ä¸­ |
| android | âš ï¸ å¯é€‰ | ğŸŸ¡ ä¸­ |

## ğŸ”§ å®æ–½æ­¥éª¤

### ç¬¬ä¸€é˜¶æ®µï¼šè„šæœ¬éªŒè¯ï¼ˆç«‹å³ï¼‰

```bash
# 1. éªŒè¯è„šæœ¬è¯­æ³•
bash -n /path/to/setup-rocky-9.4-ci-env-v3.1.sh

# 2. åœ¨æµ‹è¯•ç¯å¢ƒè¿è¡Œè„šæœ¬
sudo bash setup-rocky-9.4-ci-env-v3.1.sh

# 3. éªŒè¯æ–°å‘½ä»¤å¯ç”¨
verify-rocky-ci-env
fix-rocky-ci-env

# 4. éªŒè¯å·¥ä½œæ­£å¸¸
apt-get config-info
```

- [ ] è„šæœ¬è¯­æ³•éªŒè¯
- [ ] è„šæœ¬æˆåŠŸè¿è¡Œ
- [ ] æ–°å‘½ä»¤å­˜åœ¨
- [ ] æ–°å‘½ä»¤èƒ½æ­£å¸¸æ‰§è¡Œ

### ç¬¬äºŒé˜¶æ®µï¼šWorkflow ä¿®æ”¹ï¼ˆ24 å°æ—¶å†…ï¼‰

```bash
# 1. å¤‡ä»½ build.yml
cp .github/workflows/build.yml .github/workflows/build.yml.v3.1.bak

# 2. ç¼–è¾‘ build.ymlï¼ˆé€‰æ‹©æ–¹æ¡ˆ A æˆ– Bï¼‰
# æ–¹æ¡ˆ Aï¼šå¿«é€Ÿå®æ–½
# æ–¹æ¡ˆ Bï¼šå®Œæ•´å®æ–½

# 3. æäº¤å˜æ›´
git add .github/workflows/build.yml
git commit -m "chore: improve rocky linux workflow compatibility (v3.2+)"
git push
```

- [ ] å¤‡ä»½åŸå§‹ build.yml
- [ ] é€‰æ‹©ä¿®æ”¹æ–¹æ¡ˆ
- [ ] ç¼–è¾‘ build.yml
- [ ] æäº¤å¹¶æ¨é€å˜æ›´

### ç¬¬ä¸‰é˜¶æ®µï¼šæµ‹è¯•éªŒè¯ï¼ˆ24-48 å°æ—¶ï¼‰

```bash
# 1. ç›‘æ§ GitHub Actions workflow è¿è¡Œ
# è®¿é—®: https://github.com/CloneWolf-Jiang/rclone/actions

# 2. æ£€æŸ¥ä»¥ä¸‹ Jobs æ˜¯å¦æˆåŠŸ
#    - build (linux)
#    - build (linux_386)
#    - build (other_os)
#    - build (go1.24)

# 3. æŸ¥çœ‹æ—¥å¿—æ˜¯å¦æœ‰ç¯å¢ƒéªŒè¯è¾“å‡º
# æ—¥å¿—ä¸­åº”æ˜¾ç¤º:
#   âœ… VERIFICATION PASSED
# æˆ–
#   Environment verification failed - attempting to fix...
#   âœ… Installation complete

# 4. ç¡®è®¤æ²¡æœ‰åº“ç›¸å…³çš„é”™è¯¯
# ä¸åº”è¯¥çœ‹åˆ°:
#   libfuse-dev: æœªæ‰¾åˆ°
#   pkg-config: æœªæ‰¾åˆ°
```

- [ ] è‡³å°‘ä¸€ä¸ª build job æˆåŠŸå®Œæˆ
- [ ] ç¯å¢ƒéªŒè¯æ­¥éª¤æœ‰è¾“å‡º
- [ ] æ²¡æœ‰åº“ç¼ºå¤±çš„é”™è¯¯
- [ ] apt-get å‘½ä»¤æ­£å¸¸å·¥ä½œ

### ç¬¬å››é˜¶æ®µï¼šæ–‡æ¡£å’Œæœ€ä½³å®è·µï¼ˆæ•´ç†ï¼‰

```bash
# 1. åˆ›å»ºç»´æŠ¤æ–‡æ¡£
# å·²åˆ›å»ºçš„æ–‡æ¡£:
#   - è¡¥å……å…¼å®¹æ€§åˆ†ææŠ¥å‘Š.md
#   - build.ymlä¿®æ”¹æŒ‡å—.md
#   - v3.2è¡¥å……å…¼å®¹æ€§æ£€æŸ¥æ¸…å•.md (æœ¬æ–‡ä»¶)

# 2. æ·»åŠ åˆ°é¡¹ç›®æ–‡æ¡£
# ä½ç½®: é™„å½•/ç›®å½•

# 3. ç¼–å†™ workflow ç»´æŠ¤æŒ‡å—
# å†…å®¹: å¦‚ä½•è¯Šæ–­å’Œæ’æŸ¥é—®é¢˜
```

- [ ] æ–‡æ¡£å·²åˆ›å»º
- [ ] æ–‡æ¡£å·²æäº¤
- [ ] å›¢é˜Ÿæˆå‘˜äº†è§£æ–°å‘½ä»¤

## âœ¨ æ–°å¢ç”¨æˆ·å‘½ä»¤é€ŸæŸ¥

### å¯¹æœ€ç»ˆç”¨æˆ·çš„å½±å“

è¿è¡Œè„šæœ¬åï¼Œç”¨æˆ·å°†è·å¾—ä¸¤ä¸ªæ–°å‘½ä»¤ï¼š

#### éªŒè¯ç¯å¢ƒ

```bash
# å¿«é€Ÿå‘½ä»¤
verify-rocky-ci-env

# è¾“å‡ºç¤ºä¾‹
=== Rocky Linux CI Environment Verification ===

Checking required libraries...
âœ… FUSE development (fuse3-devel)
âœ… Package config (pkgconf-pkg-config)
...
âœ… VERIFICATION PASSED - Environment is complete
```

#### ä¿®å¤ç¯å¢ƒ

```bash
# å¿«é€Ÿå‘½ä»¤
fix-rocky-ci-env

# ç›´åˆ°ç¯å¢ƒå®Œæ•´
=== Fixing Rocky Linux CI Environment ===

Will install: nfs-utils
Running: sudo dnf install -y nfs-utils
...
âœ… Installation complete

âœ… VERIFICATION PASSED - Environment is complete
```

## ğŸ†˜ æ•…éšœæ’æŸ¥

### é—®é¢˜ 1ï¼šæ–°å‘½ä»¤æ‰¾ä¸åˆ°

**ç—‡çŠ¶**: `command not found: verify-rocky-ci-env`

**åŸå› **: ç¬¦å·é“¾æ¥åˆ›å»ºå¤±è´¥

**è§£å†³**:
```bash
# æ‰‹åŠ¨åˆ›å»ºç¬¦å·é“¾æ¥
sudo ln -sf /opt/actions-runner/compat-scripts/verify-env /usr/local/bin/verify-rocky-ci-env
sudo ln -sf /opt/actions-runner/compat-scripts/fix-env /usr/local/bin/fix-rocky-ci-env

# éªŒè¯
which verify-rocky-ci-env
which fix-rocky-ci-env
```

### é—®é¢˜ 2ï¼šéªŒè¯å¤±è´¥ä¸”æ— æ³•ä¿®å¤

**ç—‡çŠ¶**: fix-env å¤±è´¥ï¼Œæ˜¾ç¤ºæƒé™é”™è¯¯

**åŸå› **: éœ€è¦ sudo æƒé™

**è§£å†³**:
```bash
# ç¡®ä¿ runner ç”¨æˆ·æœ‰ sudo æƒé™
sudo visudo -f /etc/sudoers.d/runner

# åº”åŒ…å«æ­¤è¡Œ
runner ALL=(ALL) NOPASSWD: ALL

# æ‰‹åŠ¨å®‰è£…ç¼ºå¤±åŒ…
sudo dnf install -y <package_name>
```

### é—®é¢˜ 3ï¼šWorkflow ä¸­çš„éªŒè¯æ­¥éª¤è¢«è·³è¿‡

**ç—‡çŠ¶**: Workflow æ—¥å¿—ä¸­çœ‹ä¸åˆ° "Verify Rocky Linux" æ­¥éª¤

**åŸå› **: æ¡ä»¶ä¸åŒ¹é…æˆ– workflow ä¿®æ”¹æœªæˆåŠŸ

**è§£å†³**:
```bash
# æ£€æŸ¥ build.yml ä¸­çš„ if æ¡ä»¶
# åº”åŒ…å«: if: runner.os == 'Linux'
# æˆ–: if: matrix.os == 'ubuntu-latest'

# é‡æ–°æ¨é€ workflow æ–‡ä»¶
git add .github/workflows/build.yml
git commit -m "fix: workflow verify step"
git push
```

## ğŸ“Š é¢„æœŸæ•ˆæœ

### å®æ–½å‰

âŒ Rocky Linux runner ä¸Šç¼ºå¤±åº“é”™è¯¯  
âŒ åŒ…åè½¬æ¢å¤±è´¥  
âŒ å¼€å‘è€…ä¸çŸ¥é“å¦‚ä½•è°ƒè¯•ç¯å¢ƒé—®é¢˜  

### å®æ–½å

âœ… Rocky Linux ç¯å¢ƒè‡ªåŠ¨éªŒè¯  
âœ… ç¼ºå¤±åº“è‡ªåŠ¨ä¿®å¤  
âœ… åŒ…åè‡ªåŠ¨è½¬æ¢  
âœ… å¼€å‘è€…æœ‰æ¸…æ™°çš„è¯Šæ–­å·¥å…·  
âœ… CI/CD æµç¨‹æ›´ç¨³å®š  

## ğŸ“š ç›¸å…³æ–‡æ¡£

| æ–‡æ¡£ | ç”¨é€” | ä¼˜å…ˆçº§ |
|------|------|--------|
| [è¡¥å……å…¼å®¹æ€§åˆ†ææŠ¥å‘Š.md](è¡¥å……å…¼å®¹æ€§åˆ†ææŠ¥å‘Š.md) | é—®é¢˜åˆ†æå’Œæ–¹æ¡ˆå¯¹æ¯” | ğŸ”´ å¿…è¯» |
| [build.ymlä¿®æ”¹æŒ‡å—.md](build.ymlä¿®æ”¹æŒ‡å—.md) | workflow ä¿®æ”¹å…·ä½“æ“ä½œ | ğŸ”´ å¿…è¯» |
| [README-v3.2.md](README-v3.2.md) | å®Œæ•´çš„å®‰è£…æŒ‡å— | ğŸŸ¡ å‚è€ƒ |
| [å¿«é€Ÿå‚è€ƒ-JSONé…ç½®.md](å¿«é€Ÿå‚è€ƒ-JSONé…ç½®.md) | jq å‘½ä»¤æŸ¥è¯¢ | ğŸŸ¢ éœ€è¦æ—¶æŸ¥çœ‹ |
| [v3.2å˜æ›´æ—¥å¿—.md](v3.2å˜æ›´æ—¥å¿—.md) | ç‰ˆæœ¬å‡çº§è¯´æ˜ | ğŸŸ¢ å‚è€ƒ |

## âœ… æœ€ç»ˆæ£€æŸ¥æ¸…å•

**è„šæœ¬å±‚é¢**:
- [ ] setup è„šæœ¬åŒ…å« verify-env å’Œ fix-env
- [ ] ä¸¤ä¸ªè„šæœ¬éƒ½æ˜¯å¯æ‰§è¡Œçš„
- [ ] ç¬¦å·é“¾æ¥å·²åˆ›å»º
- [ ] å‘½ä»¤èƒ½æ­£å¸¸è¿è¡Œ

**Workflow å±‚é¢**:
- [ ] build.yml å·²å¤‡ä»½
- [ ] build.yml å·²ä¿®æ”¹ï¼ˆé€‰æ‹©æ–¹æ¡ˆ A æˆ– Bï¼‰
- [ ] ä¿®æ”¹å·²æ¨é€åˆ° GitHub
- [ ] è‡³å°‘è¿è¡Œè¿‡ä¸€æ¬¡ workflow

**éªŒè¯å±‚é¢**:
- [ ] workflow æ—¥å¿—æ˜¾ç¤ºéªŒè¯é€šè¿‡æˆ–ä¿®å¤æˆåŠŸ
- [ ] æ²¡æœ‰åº“ç›¸å…³çš„é”™è¯¯
- [ ] build jobs (linux/linux_386/other_os/go1.24) éƒ½æˆåŠŸ
- [ ] apt-get å‘½ä»¤å·¥ä½œæ­£å¸¸

**æ–‡æ¡£å±‚é¢**:
- [ ] è¡¥å……å…¼å®¹æ€§æ–‡æ¡£å·²åˆ›å»º
- [ ] build.yml ä¿®æ”¹æŒ‡å—å·²åˆ›å»º
- [ ] å›¢é˜Ÿäº†è§£æ–°çš„è¯Šæ–­å‘½ä»¤
- [ ] ç»´æŠ¤æ–‡æ¡£å·²æ›´æ–°

---

**çŠ¶æ€**: ğŸ“¦ å‡†å¤‡å°±ç»ª  
**ç‰ˆæœ¬**: v3.2+ (è¡¥å……å…¼å®¹æ€§ç‰ˆæœ¬)  
**æœ€åæ›´æ–°**: 2026-02-20

å»ºè®®: æŒ‰ç…§ä¸Šé¢çš„å®æ–½æ­¥éª¤ä¾æ¬¡è¿›è¡Œï¼Œé¢„è®¡æ€»è€—æ—¶ 48 å°æ—¶ã€‚
