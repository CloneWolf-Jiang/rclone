# å¿«é€Ÿå‚è€ƒï¼špackage-map.json v3.2.1 ç»´æŠ¤æŒ‡å—

## ğŸ“Œ æœ€å¸¸ç”¨çš„æ˜ å°„ï¼ˆGitHub Actions å·¥ä½œæµï¼‰

è¿™äº›æ˜¯åœ¨ GitHub Actions ä¸­æœ€å¸¸è¢«ä½¿ç”¨çš„æ˜ å°„ï¼Œç¡®ä¿ workflow èƒ½åœ¨ Rocky ä¸Šæ­£å¸¸ç¼–è¯‘ï¼š

### ğŸ”´ CRITICAL (å¿…é¡»æœ‰)

```json
{
  "libfuse-dev": "fuse3-devel",      // FUSE å¼€å‘åº“ - rclone ç¼–è¯‘å¿…éœ€
  "nfs-common": "nfs-utils",         // NFS æ”¯æŒ - Linux æµ‹è¯•å¿…éœ€
  "pkg-config": "pkgconf-pkg-config" // åŒ…é…ç½®å·¥å…·
}
```

### ğŸŸ¡ IMPORTANT (ä¸€èˆ¬éœ€è¦)

```json
{
  "gcc": "gcc",
  "g++": "gcc-c++",
  "make": "make",
  "python3-dev": "python3-devel",
  "libssl-dev": "openssl-devel",
  "zlib1g-dev": "zlib-devel",
  "ncurses-dev": "ncurses-devel"
}
```

## ğŸ”§ å¿«é€Ÿå‘½ä»¤

### æ£€æŸ¥æ˜ å°„æ˜¯å¦å­˜åœ¨

```bash
# æ£€æŸ¥ libfuse-dev æ˜ å°„
jq '.["libfuse-dev"]' /opt/actions-runner/compat-scripts/package-map.json

# æ£€æŸ¥ nfs-common æ˜ å°„
jq '.["nfs-common"]' /opt/actions-runner/compat-scripts/package-map.json

# æŸ¥çœ‹æ‰€æœ‰éå…ƒæ•°æ®æ˜ å°„
jq 'to_entries[] | select(.key | startswith("_") | not)' \
  /opt/actions-runner/compat-scripts/package-map.json
```

### æ·»åŠ /ä¿®æ”¹æ˜ å°„

```bash
# æ·»åŠ æ–°çš„åŒ…æ˜ å°„
jq '.["æ–°åŒ…å"] = "RockyåŒ…å"' \
  /opt/actions-runner/compat-scripts/package-map.json \
  > /tmp/package-map.json && \
  sudo mv /tmp/package-map.json \
  /opt/actions-runner/compat-scripts/package-map.json

# ä¾‹: æ·»åŠ  libpng-dev â†’ libpng-devel æ˜ å°„
jq '.["libpng-dev"] = "libpng-devel"' \
  /opt/actions-runner/compat-scripts/package-map.json \
  > /tmp/package-map.json && \
  sudo mv /tmp/package-map.json \
  /opt/actions-runner/compat-scripts/package-map.json
```

### éªŒè¯ JSON æ ¼å¼

```bash
# éªŒè¯æ˜ å°„è¡¨æœ‰æ•ˆæ€§
jq . /opt/actions-runner/compat-scripts/package-map.json > /dev/null && echo "âœ… Valid"

# æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯
jq '._version, ._last_updated' /opt/actions-runner/compat-scripts/package-map.json
```

### æŸ¥çœ‹ apt-get wrapper é…ç½®

```bash
# ç›´æ¥è°ƒç”¨
/opt/actions-runner/compat-scripts/apt-get config-info

# æˆ–ä»å‘½ä»¤è¡Œ
apt-get config-info
```

## ğŸ¯ å¸¸è§åœºæ™¯

### åœºæ™¯ 1: GitHub Actions å·¥ä½œæµå¤±è´¥ï¼Œæ˜¾ç¤º"æœªæ‰¾åˆ°åŒ¹é…çš„å‚æ•°"

**ç—‡çŠ¶**:
```
æœªæ‰¾åˆ°åŒ¹é…çš„å‚æ•°: libfuse-dev
```

**æ£€æŸ¥æ­¥éª¤**:
```bash
# 1. æ£€æŸ¥æ˜ å°„è¡¨æ˜¯å¦å­˜åœ¨
test -f /opt/actions-runner/compat-scripts/package-map.json && echo "âœ… æ–‡ä»¶å­˜åœ¨" || echo "âŒ æ–‡ä»¶ä¸å­˜åœ¨"

# 2. æ£€æŸ¥ JSON æ ¼å¼
jq . /opt/actions-runner/compat-scripts/package-map.json >/dev/null 2>&1 && echo "âœ… JSON æœ‰æ•ˆ" || echo "âŒ JSON æ— æ•ˆ"

# 3. æ£€æŸ¥ç‰¹å®šæ˜ å°„
jq '.["libfuse-dev"]' /opt/actions-runner/compat-scripts/package-map.json

# 4. æµ‹è¯• apt-get wrapper
/opt/actions-runner/compat-scripts/apt-get config-info
```

**å¿«é€Ÿä¿®å¤**:
```bash
# é‡æ–°ç”Ÿæˆé…ç½®æ–‡ä»¶
sudo bash /path/to/setup-rocky-9.4-ci-env-v3.1.sh
```

### åœºæ™¯ 2: æ·»åŠ æ–°çš„ workflowï¼Œéœ€è¦æ–°çš„åŒ…

**æ­¥éª¤**:

1. ç¡®å®š Ubuntu åŒ…åå’Œ Rocky åŒ…å
   ```bash
   # Ubuntu: apt-cache search åŒ…å (åœ¨ Ubuntu ç³»ç»Ÿä¸Š)
   # Rocky: dnf search åŒ…å (åœ¨ Rocky ç³»ç»Ÿä¸Š)
   ```

2. æ·»åŠ åˆ°æ˜ å°„è¡¨
   ```bash
   jq '.["ubuntu-package"] = "rocky-package"' \
     /opt/actions-runner/compat-scripts/package-map.json \
     > /tmp/new-map.json && \
     sudo mv /tmp/new-map.json \
     /opt/actions-runner/compat-scripts/package-map.json
   ```

3. éªŒè¯
   ```bash
   jq '.["ubuntu-package"]' /opt/actions-runner/compat-scripts/package-map.json
   ```

### åœºæ™¯ 3: åŒ…åœ¨ Rocky ä¸­ä¸å­˜åœ¨ï¼Œåº”è¯¥å¿½ç•¥

**ç¼–è¾‘å¿½ç•¥åˆ—è¡¨**:
```bash
jq '.ignore += ["æ–°åŒ…å"]' \
  /opt/actions-runner/compat-scripts/ignore-packages.json \
  > /tmp/ignore.json && \
  sudo mv /tmp/ignore.json \
  /opt/actions-runner/compat-scripts/ignore-packages.json
```

## ğŸ“Š æ˜ å°„è¡¨ç»Ÿè®¡

### æŒ‰åˆ†ç±»çš„æ˜ å°„é¡¹æ•°

```bash
jq 'to_entries | group_by(.value | type) | map({(.[0].value): length})' \
  /opt/actions-runner/compat-scripts/package-map.json
```

### æŸ¥çœ‹æ‰€æœ‰åˆ†ç±»æ ‡ç­¾

```bash
jq 'to_entries[] | select(.key | startswith("ç¼–è¾‘") or startswith("åŒ…") or startswith("æ–‡ä»¶") or startswith("å¼€å‘") or startswith("å‹ç¼©") or startswith("ç½‘ç»œ") or startswith("ç³»ç»Ÿ") or startswith("å…¶ä»–")) | .key' \
  /opt/actions-runner/compat-scripts/package-map.json
```

## ğŸš¨ æ•…éšœæ’æŸ¥

### é—®é¢˜: jq å‘½ä»¤æ‰¾ä¸åˆ°

```bash
# æ£€æŸ¥ jq æ˜¯å¦å®‰è£…
which jq

# å¦‚æœæœªå®‰è£…ï¼Œå®‰è£…
sudo dnf install -y jq
```

### é—®é¢˜: æƒé™é”™è¯¯

```bash
# æ£€æŸ¥æ–‡ä»¶æƒé™
ls -la /opt/actions-runner/compat-scripts/

# ä¿®å¤æƒé™
sudo chmod 644 /opt/actions-runner/compat-scripts/package-map.json
sudo chmod 644 /opt/actions-runner/compat-scripts/ignore-packages.json
sudo chmod 755 /opt/actions-runner/compat-scripts/
```

### é—®é¢˜: apt-get wrapper æœªè¢«è°ƒç”¨

```bash
# æ£€æŸ¥ PATH ä¸­çš„ apt-get
which apt-get

# åº”è¯¥è¾“å‡º:
# /usr/bin/apt-get (è½¯é“¾æ¥)
# æˆ–
# /usr/local/bin/apt-get (è½¯é“¾æ¥)

# å¦‚æœä¸æ­£ç¡®ï¼Œé‡æ–°è¿è¡Œ setup è„šæœ¬:
sudo bash setup-rocky-9.4-ci-env-v3.1.sh
```

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. å®šæœŸéªŒè¯

```bash
# åœ¨é‡è¦è¿è¡Œå‰éªŒè¯
verify-rocky-ci-env

# æˆ–æ‰‹åŠ¨æ£€æŸ¥
jq . /opt/actions-runner/compat-scripts/package-map.json > /dev/null && echo "âœ… é…ç½®æœ‰æ•ˆ"
```

### 2. å¤‡ä»½é…ç½®

å¦‚æœæ‰‹åŠ¨ä¿®æ”¹æ˜ å°„è¡¨ï¼Œå…ˆå¤‡ä»½ï¼š
```bash
sudo cp /opt/actions-runner/compat-scripts/package-map.json \
        /opt/actions-runner/compat-scripts/package-map.json.backup-$(date +%Y%m%d)
```

### 3. æµ‹è¯•æ–°æ˜ å°„

åœ¨æ·»åŠ æ–°æ˜ å°„åï¼Œæµ‹è¯•ï¼š
```bash
# æµ‹è¯•å•ä¸ªåŒ…æ˜ å°„
/opt/actions-runner/compat-scripts/apt-get install --simulate -y æ–°åŒ…å

# æˆ–ç”¨ jq éªŒè¯
jq '.["æ–°åŒ…å"]' /opt/actions-runner/compat-scripts/package-map.json
```

### 4. è®°å½•æ›´æ”¹

ä¿®æ”¹æ˜ å°„è¡¨æ—¶ï¼Œæ›´æ–° `_last_updated` å­—æ®µï¼š
```bash
jq '._last_updated = "YYYY-MM-DD - ä¿®æ”¹è¯´æ˜"' \
  /opt/actions-runner/compat-scripts/package-map.json \
  > /tmp/map.json && \
  sudo mv /tmp/map.json \
  /opt/actions-runner/compat-scripts/package-map.json
```

## ğŸ“š å‚è€ƒæ–‡æ¡£

- [JSONæ˜ å°„è¡¨-v3.2.1-æ›´æ–°è¯´æ˜.md](JSONæ˜ å°„è¡¨-v3.2.1-æ›´æ–°è¯´æ˜.md) - å®Œæ•´çš„å‡çº§è¯´æ˜
- [setup-rocky-9.4-ci-env-v3.1.sh](setup-rocky-9.4-ci-env-v3.1.sh) - ä¸»è®¾ç½®è„šæœ¬
- [RUN-22220002065-é”™è¯¯åˆ†ææŠ¥å‘Š.md](RUN-22220002065-é”™è¯¯åˆ†ææŠ¥å‘Š.md) - è§¦å‘æ­¤æ›´æ–°çš„é”™è¯¯åˆ†æ

## ğŸ”— èµ„æºé“¾æ¥

- **Ubuntu åŒ…æŸ¥è¯¢**: https://packages.ubuntu.com/jammy/
- **Rocky Linux åŒ…æŸ¥è¯¢**: https://packages.rockylinux.org/
- **jq æ‰‹å†Œ**: https://stedolan.github.io/jq/
