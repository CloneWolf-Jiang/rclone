<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Docker CI/CD æ–¹æ¡ˆ - å®Œæ•´æŒ‡å—</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', 'PingFang SC', sans-serif; line-height: 1.6; color: #333; background-color: #f8f9fa; padding: 40px 20px; }
        .container { max-width: 1000px; margin: 0 auto; background: white; padding: 60px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); }
        h1 { font-size: 36px; color: #1a1a1a; margin-bottom: 10px; font-weight: 700; }
        .subtitle { font-size: 14px; color: #666; margin-bottom: 40px; padding: 12px; background: #f5f5f5; border-left: 4px solid #2196F3; border-radius: 4px; }
        h2 { font-size: 24px; color: #1a1a1a; margin-top: 50px; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 3px solid #2196F3; }
        h3 { font-size: 18px; color: #2c3e50; margin-top: 25px; margin-bottom: 15px; font-weight: 600; }
        h4 { font-size: 15px; color: #34495e; margin-top: 15px; margin-bottom: 10px; font-weight: 600; }
        p { margin-bottom: 15px; font-size: 14px; line-height: 1.8; }
        .info-box { padding: 20px; margin: 20px 0; border-radius: 6px; border-left: 5px solid; }
        .info-box.success { background-color: #e8f5e9; border-left-color: #4CAF50; }
        .info-box.info { background-color: #e3f2fd; border-left-color: #2196F3; }
        .info-box.warning { background-color: #fff3e0; border-left-color: #ff9800; }
        .info-box.danger { background-color: #ffebee; border-left-color: #f44336; }
        code { background: #f0f0f0; padding: 2px 6px; border-radius: 3px; font-family: 'Courier New', monospace; font-size: 13px; }
        .code-block { background-color: #1e1e1e; color: #d4d4d4; padding: 15px; border-radius: 6px; overflow-x: auto; margin: 15px 0; font-family: 'Courier New', monospace; font-size: 13px; line-height: 1.8; border: 1px solid #333; white-space: pre-wrap; word-wrap: break-word; display: block; }
        table { width: 100%; border-collapse: collapse; margin: 20px 0; font-size: 13px; }
        table th { background-color: #f5f5f5; padding: 12px; text-align: left; font-weight: 600; border-bottom: 2px solid #ddd; }
        table td { padding: 12px; border-bottom: 1px solid #e0e0e0; }
        table tr:hover { background-color: #f9f9f9; }
        ul, ol { margin-left: 20px; margin-bottom: 15px; }
        li { margin-bottom: 8px; font-size: 14px; }
        .toc { background: #f0f5ff; padding: 20px; border-radius: 6px; margin: 30px 0; border-left: 4px solid #2196F3; }
        .toc h3 { margin-top: 0; color: #2196F3; }
        .toc ul { list-style: none; margin-left: 0; }
        .toc a { color: #2196F3; text-decoration: none; font-size: 14px; }
        a { color: #2196F3; text-decoration: none; }
        .footer { text-align: right; font-size: 12px; color: #999; margin-top: 50px; padding-top: 20px; border-top: 1px solid #eee; }
        @media print { body { background: white; padding: 0; } .container { box-shadow: none; } }
    </style>
</head>
<body>
<div class="container">
<h1>ğŸ³ Docker CI/CD æ–¹æ¡ˆ - å®Œæ•´æŒ‡å—</h1>
<div class="subtitle">æ•´åˆæ‰€æœ‰ Docker æ–‡æ¡£ | æ—¥æœŸ: 2026-02-20 | ç‰ˆæœ¬: v1.0 | çŠ¶æ€: âœ… æ­£å¼ç‰ˆæœ¬</div>

<div class="toc">
<h3>ğŸ“‘ å¿«é€Ÿå¯¼èˆª</h3>
<ul>
<li><a href="#section1">1. æ–‡ä»¶ä½¿ç”¨è¯´æ˜</a></li>
<li><a href="#section2">2. éªŒè¯éƒ¨ç½²æŒ‡å—</a></li>
<li><a href="#section3">3. å¿«é€Ÿå‚è€ƒ</a></li>
<li><a href="#section4">4. å®Œæ•´éƒ¨ç½²æŒ‡å—</a></li>
<li><a href="#section5">5. è¿ç§»æŒ‡å—</a></li>
<li><a href="#section6">6. èµ„æºæ€»è§ˆ</a></li>
</ul>
</div>

<div id="section1">
<h2>1ï¸âƒ£ Docker CI æ–¹æ¡ˆ - æ–‡ä»¶ä½¿ç”¨è¯´æ˜</h2>
<p><strong>æ•´ç†æ—¥æœŸ</strong>: 2026-02-20</p>

<h3>ğŸ“‚ æ–‡ä»¶ä½ç½®</h3>
<p>æ‰€æœ‰ Docker ç›¸å…³æ–‡ä»¶å·²æ•´ç†åˆ° <code>é™„å½•/Docker</code> ç›®å½•ä¸‹:</p>
<div class="code-block">é™„å½•/Docker/
â”œâ”€â”€ Dockerfile.ci                # CI ä¸“ç”¨ Docker é•œåƒå®šä¹‰
â”œâ”€â”€ docker-compose.yml           # æœ¬åœ°å¼€å‘ docker-compose é…ç½®
â”œâ”€â”€ docker-ci-commands.sh        # ä¾¿æ·å·¥å…·è„šæœ¬
â”œâ”€â”€ docker-build.yml             # GitHub Actions å·¥ä½œæµé…ç½®
â”œâ”€â”€ Dockeræ–¹æ¡ˆéƒ¨ç½²æŒ‡å—.md         # å®Œæ•´éƒ¨ç½²æ–‡æ¡£
â”œâ”€â”€ Dockerå¿«é€Ÿå‚è€ƒ.md            # é€ŸæŸ¥è¡¨
â”œâ”€â”€ è¿ç§»æŒ‡å—-ä»è£¸æœºåˆ°Docker.md   # è¿ç§»æ­¥éª¤
â””â”€â”€ Docker_CIèµ„æºæ€»è§ˆ.md         # èµ„æºå¯¼èˆª</div>

<h3>ğŸ”§ ä½¿ç”¨æ–¹æ³•</h3>

<h4>æ–¹æ³• 1: åˆ›å»ºç¬¦å·é“¾æ¥ï¼ˆæ¨èï¼‰</h4>
<div class="code-block"># Windows PowerShell (ç®¡ç†å‘˜æƒé™)
cd H:\rClone\rclone
New-Item -ItemType SymbolicLink -Path "Dockerfile.ci" -Target "é™„å½•\Docker\Dockerfile.ci" -Force

# Linux/macOS (Bash)
cd /path/to/rclone
ln -sf é™„å½•/Docker/Dockerfile.ci Dockerfile.ci
ln -sf é™„å½•/Docker/docker-compose.yml docker-compose.yml</div>

<p><strong>ä¼˜åŠ¿</strong>: ä¿æŒé¡¹ç›®æ•´æ´ï¼ˆå•ç‚¹è®¿é—®ï¼‰ï¼ŒDocker å‘½ä»¤å¯ç›´æ¥ä½¿ç”¨ï¼Œæ–‡ä»¶é›†ä¸­ç®¡ç†</p>

<h4>æ–¹æ³• 2: ç›´æ¥å¤åˆ¶æ–‡ä»¶åˆ°æ ¹ç›®å½•</h4>
<div class="code-block">cp é™„å½•/Docker/Dockerfile.ci ./
cp é™„å½•/Docker/docker-compose.yml ./
cp é™„å½•/Docker/docker-ci-commands.sh ./</div>

<h4>æ–¹æ³• 3: ä½¿ç”¨å®Œæ•´è·¯å¾„</h4>
<div class="code-block">docker build -f é™„å½•/Docker/Dockerfile.ci -t rclone-ci:latest .</div>

<h3>ğŸ“‹ å¿«é€Ÿå¼€å§‹</h3>

<div class="info-box info">
<strong>Step 1: è®¾ç½®æ–‡ä»¶</strong><br>
æ¨èä½¿ç”¨æ–¹æ³• 1ï¼ˆç¬¦å·é“¾æ¥ï¼‰
</div>

<div class="info-box info">
<strong>Step 2: æ„å»ºé•œåƒ</strong><br>
docker build -f Dockerfile.ci -t rclone-ci:latest .
</div>

<div class="info-box success">
<strong>Step 3: éªŒè¯ç¯å¢ƒ</strong><br>
docker run --rm rclone-ci:latest verify-ci-env
</div>

<div class="info-box info">
<strong>Step 4: å¼€å§‹ä½¿ç”¨</strong><br>
docker-compose up -d<br>
docker-compose exec runner bash<br>
docker-compose down
</div>

<h3>ğŸ“š æ–‡æ¡£å¯¼èˆª</h3>
<table>
<tr><th>æ–‡ä»¶</th><th>è¯´æ˜</th></tr>
<tr><td>Dockeræ–¹æ¡ˆéƒ¨ç½²æŒ‡å—.md</td><td>ğŸ“– è¯¦ç»†éƒ¨ç½²ã€æ•…éšœæ’æŸ¥ã€æœ€ä½³å®è·µ</td></tr>
<tr><td>Dockerå¿«é€Ÿå‚è€ƒ.md</td><td>âš¡ é€ŸæŸ¥è¡¨ã€å¸¸ç”¨å‘½ä»¤ã€ä»£ç ç‰‡æ®µ</td></tr>
<tr><td>è¿ç§»æŒ‡å—-ä»è£¸æœºåˆ°Docker.md</td><td>ğŸ”„ ä»æ—§æ–¹æ¡ˆè¿ç§»çš„åˆ†æ­¥æŒ‡å—</td></tr>
<tr><td>Docker_CIèµ„æºæ€»è§ˆ.md</td><td>ğŸ“Œ èµ„æºç´¢å¼•å’Œå¯¼èˆª</td></tr>
</table>
</div>

<div id="section2">
<h2>2ï¸âƒ£ Docker ç¯å¢ƒéªŒè¯éƒ¨ç½²æŒ‡å—</h2>

<h3>ğŸ“‚ é¡¹ç›®æ–‡ä»¶æ¸…å•</h3>

<p><strong>è¯´æ˜</strong>ï¼šæœ¬éƒ¨åˆ†ä»…åˆ—å‡ºæ¥è‡ªé¡¹ç›®ä»“åº“çš„é…ç½®ã€å·¥ä½œæµå’Œæ–‡æ¡£æ–‡ä»¶ï¼Œä¸åŒ…æ‹¬ .sh è„šæœ¬å’Œ .ci Dockerfile çš„è¯´æ˜ã€‚</p>

<table>
<tr><th>æ–‡ä»¶å</th><th>ä½ç½®</th><th>ç”¨é€”</th><th>æ¥æº</th></tr>
<tr><td><code>ç›®å½•ç»“æ„å®‰æ’è¯´æ˜.md</code></td><td>é™„å½•/Docker/</td><td>Rocky 9.4 ä¸»æœºç›®å½•ç»“æ„å’Œéƒ¨ç½²æ¸…å•</td><td>é¡¹ç›®ä»“åº“</td></tr>
<tr><td><code>Docker-Runner-éƒ¨ç½²éªŒè¯æŒ‡å—.md</code></td><td>é™„å½•/Docker/</td><td>æœ¬åœ°éªŒè¯æ–¹æ¡ˆï¼ˆ3ç§éªŒè¯æ–¹æ³•ï¼‰</td><td>é¡¹ç›®ä»“åº“</td></tr>
<tr><td><code>docker-runner-verify.yml</code></td><td>.github/workflows/</td><td>GitHub Actions è‡ªåŠ¨éªŒè¯å·¥ä½œæµ</td><td>é¡¹ç›®ä»“åº“</td></tr>
</table>

<h3>ğŸ”‘ å…³é”®æ”¹è¿›</h3>

<div class="info-box success">
<strong>âœ… é›†æˆéªŒè¯æ¡†æ¶ï¼ˆv2.0 æ–°ç‰¹æ€§ï¼‰</strong><br><br>
<strong>é—®é¢˜èƒŒæ™¯</strong>ï¼šæ—©æœŸéƒ¨ç½²æ—¶éœ€è¦åˆ†åˆ«è¿è¡ŒéªŒè¯è„šæœ¬å’Œæ„å»ºè„šæœ¬<br><br>
<strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šå°† <code>verify-docker-runner.sh</code> çš„å®Œæ•´éªŒè¯é€»è¾‘é›†æˆåˆ° <code>docker-ci-commands.sh build</code> å‘½ä»¤<br><br>
<strong>æ•ˆæœ</strong>ï¼šä¸€æ¡å‘½ä»¤å®ŒæˆéªŒè¯ + æ„å»º + éªŒè¯ï¼Œæ— éœ€åˆ†æ­¥æ“ä½œ
</div>

<p><strong>æ”¹è¿›å‰ï¼š</strong>éœ€è¦å¤šæ­¥æ“ä½œ</p>
<div class="code-block">bash verify-docker-runner.sh        # å•ç‹¬è¿è¡ŒéªŒè¯
docker build -f Dockerfile.ci ...   # å†æ„å»ºé•œåƒ
docker run ... éªŒè¯å·¥å…·             # æœ€åæ‰‹åŠ¨éªŒè¯</div>

<p><strong>æ”¹è¿›åï¼š</strong>ä¸€æ¡å‘½ä»¤æå®š</p>
<div class="code-block">./docker-ci-commands.sh build  # è‡ªåŠ¨å®Œæˆæ‰€æœ‰å·¥ä½œ</div>

<h3>ğŸ“– å„æ–‡ä»¶è¯´æ˜</h3>

<h4>1ï¸âƒ£ ç›®å½•ç»“æ„å®‰æ’è¯´æ˜.md</h4>
<p><strong>ä¸»è¦å†…å®¹</strong>ï¼š</p>
<ul>
<li>Rocky 9.4 ä¸»æœºæ ‡å‡†ç›®å½•ç»“æ„å®šä¹‰</li>
<li>5 ä¸ªå…³é”®æ–‡ä»¶çš„å¤åˆ¶æ¸…å•</li>
<li>æ‰‹å·¥éƒ¨ç½²æ­¥éª¤ï¼ˆå« Docker è‡ªåŠ¨å®‰è£…é€‰é¡¹ï¼‰</li>
<li>ä½¿ç”¨ docker-ci-commands.sh çš„å¿«é€ŸéªŒè¯æµç¨‹</li>
<li>å…¶ä»–å‘½ä»¤å‚è€ƒè¡¨</li>
</ul>

<p><strong>ä½•æ—¶æŸ¥çœ‹</strong>ï¼šåˆæ¬¡éƒ¨ç½²åˆ° Rocky ä¸»æœºæ—¶ï¼ŒæŒ‰æ­¤æ–‡æ¡£çš„æ­¥éª¤æ‰§è¡Œ</p>

<p><strong>å…³é”®æ­¥éª¤</strong>ï¼š</p>
<div class="code-block"># 1. åˆ›å»ºç›®å½•ç»“æ„
mkdir -p ~/rclone/Docker ~/.github/workflows

# 2. å¤åˆ¶æ–‡ä»¶åˆ°æŒ‡å®šä½ç½®
cp Dockerfile.ci ~/rclone/
cp docker-ci-commands.sh ~/rclone/
chmod +x ~/rclone/docker-ci-commands.sh

# 3. è¿è¡Œæ„å»ºå’ŒéªŒè¯ï¼ˆä¸€æ¡å‘½ä»¤ï¼‰
cd ~/rclone
./docker-ci-commands.sh build</div>

<div class="info-box info">
<strong>ğŸ’¡ æç¤º</strong>ï¼šå¦‚æœæ˜¯é¦–æ¬¡éƒ¨ç½²ä¸” Docker æœªå®‰è£…ï¼Œè„šæœ¬ä¼šè‡ªåŠ¨æ£€æµ‹ï¼Œä½ å¯ä»¥è¿è¡Œï¼š<br>
<code>./docker-ci-commands.sh setup</code> æ¥å®‰è£… Docker
</div>

<h4>2ï¸âƒ£ Docker-Runner-éƒ¨ç½²éªŒè¯æŒ‡å—.md</h4>

<p><strong>ä¸»è¦å†…å®¹</strong>ï¼š</p>
<ul>
<li><strong>æ–¹æ³• 1ï¼šæœ¬åœ°éªŒè¯è„šæœ¬</strong>ï¼ˆverify-docker-runner.shï¼‰</li>
<li><strong>æ–¹æ³• 2ï¼šCLI é›†æˆéªŒè¯</strong>ï¼ˆdocker-ci-commands.sh buildï¼‰</li>
<li><strong>æ–¹æ³• 3ï¼šGitHub Actions å·¥ä½œæµ</strong>ï¼ˆdocker-runner-verify.ymlï¼‰</li>
</ul>

<p><strong>3 ç§éªŒè¯æ–¹æ³•å¯¹æ¯”</strong>ï¼š</p>
<table>
<tr><th>æ–¹æ³•</th><th>è§¦å‘æ–¹å¼</th><th>æ‰§è¡Œä½ç½®</th><th>è€—æ—¶</th><th>æ¨èåœºæ™¯</th></tr>
<tr><td><strong>æœ¬åœ°è„šæœ¬</strong></td><td>æ‰‹åŠ¨æ‰§è¡Œ</td><td>Rocky ä¸»æœº</td><td>5 åˆ†é’Ÿ</td><td>åˆå§‹è¯Šæ–­ã€æ•…éšœæ’æŸ¥</td></tr>
<tr><td><strong>CLI é›†æˆ</strong> â­</td><td>æ‰‹åŠ¨æ‰§è¡Œ</td><td>Rocky ä¸»æœº</td><td>10-15 åˆ†é’Ÿ</td><td>æ—¥å¸¸éƒ¨ç½²ã€éªŒè¯æ„å»º</td></tr>
<tr><td><strong>GitHub Actions</strong></td><td>è‡ªåŠ¨/æ‰‹åŠ¨è§¦å‘</td><td>GitHub äº‘ç«¯</td><td>15-20 åˆ†é’Ÿ</td><td>CI/CD æµç¨‹ã€è‡ªåŠ¨éªŒè¯</td></tr>
</table>

<p><strong>æ¨èä½¿ç”¨</strong>ï¼š<code>docker-ci-commands.sh build</code>ï¼ˆæ–¹æ³• 2 - æ ‡è®° â­ï¼‰</p>

<h4>3ï¸âƒ£ docker-runner-verify.ymlï¼ˆGitHub Actions å·¥ä½œæµï¼‰</h4>

<p><strong>ä¸»è¦å†…å®¹</strong>ï¼š</p>
<ul>
<li>GitHub Actions ä¸­çš„è‡ªåŠ¨éªŒè¯å·¥ä½œæµ</li>
<li>åŒ…å« 7 æ­¥å®Œæ•´éªŒè¯è¿‡ç¨‹</li>
<li>ç”Ÿæˆç»“æ„åŒ–çš„éªŒè¯æŠ¥å‘Š</li>
<li>æ”¯æŒæ‰‹åŠ¨è§¦å‘å’Œè‡ªåŠ¨è§¦å‘</li>
</ul>

<p><strong>ä½•æ—¶ä½¿ç”¨</strong>ï¼š</p>
<ul>
<li>å½“ä»£ç æ¨é€åˆ° GitHub æ—¶è‡ªåŠ¨è¿è¡Œ</li>
<li>æ‰‹åŠ¨ä» GitHub Web UI è§¦å‘</li>
<li>ç”¨äºè¿œç¨‹ CI/CD éªŒè¯ç¯èŠ‚</li>
</ul>

<p><strong>å·¥ä½œæµè§¦å‘æ–¹å¼</strong>ï¼š</p>
<div class="code-block"># æ–¹å¼ 1ï¼šä»£ç æ¨é€è‡ªåŠ¨è§¦å‘
git push origin main

# æ–¹å¼ 2ï¼šæ‰‹åŠ¨è§¦å‘ï¼ˆGitHub Webï¼‰
Actions â†’ docker-runner-verify â†’ Run workflow

# æ–¹å¼ 3ï¼šå®šæ—¶è§¦å‘ï¼ˆå¯é€‰é…ç½®ï¼‰
# æ¯å‘¨ä¸€å‡Œæ™¨ 2 ç‚¹è‡ªåŠ¨éªŒè¯
schedule:
  - cron: '0 2 * * 1'</div>

<h3>ğŸ¯ ä¸‰å±‚éªŒè¯ä½“ç³»</h3>

<p><strong>v2.0 é‡‡ç”¨åˆ†å±‚éªŒè¯è®¾è®¡</strong>ï¼š</p>

<table>
<tr><th>éªŒè¯å±‚</th><th>è„šæœ¬/å·¥ä½œæµ</th><th>å‘½ä»¤</th><th>éªŒè¯å†…å®¹</th><th>é¢‘ç‡</th></tr>
<tr><td><strong>ç¬¬ 1 å±‚ï¼šæœ¬åœ°è¯Šæ–­</strong></td><td>verify-docker-runner.sh</td><td><code>bash Docker/verify-docker-runner.sh</code></td><td>ç³»ç»Ÿã€Dockerã€ç½‘ç»œã€èµ„æº</td><td>æ•…éšœæ’æŸ¥</td></tr>
<tr><td><strong>ç¬¬ 2 å±‚ï¼šæ„å»ºéªŒè¯</strong> â­</td><td>docker-ci-commands.sh</td><td><code>./docker-ci-commands.sh build</code></td><td>éªŒè¯ + é•œåƒæ„å»º + å·¥å…·éªŒè¯</td><td>æ¯æ¬¡éƒ¨ç½²</td></tr>
<tr><td><strong>ç¬¬ 3 å±‚ï¼šCI éªŒè¯</strong></td><td>docker-runner-verify.yml</td><td>GitHub Web è§¦å‘</td><td>è¿œç¨‹è‡ªåŠ¨éªŒè¯ã€ç”ŸæˆæŠ¥å‘Š</td><td>ä»£ç æäº¤</td></tr>
</table>

<h3>ğŸ“‹ å¦‚ä½•ä½¿ç”¨ docker-ci-commands.sh å‘½ä»¤</h3>

<p><strong>å‘½ä»¤è¯­æ³•</strong>ï¼š</p>
<div class="code-block">cd ~/rclone
./docker-ci-commands.sh <command> [options]</div>

<h4>æ ¸å¿ƒå‘½ä»¤</h4>

<table>
<tr><th>å‘½ä»¤</th><th>ä½œç”¨</th><th>è€—æ—¶</th><th>è¯´æ˜</th></tr>
<tr><td><code>build</code></td><td>âŒ æ„å»º + éªŒè¯</td><td>10-15 åˆ†é’Ÿ</td><td>å®Œæ•´çš„æ„å»ºæµç¨‹ï¼ŒåŒ…å« 7 æ­¥éªŒè¯</td></tr>
<tr><td><code>build --no-cache</code></td><td>âŒ å®Œæ•´é‡å»º</td><td>20-30 åˆ†é’Ÿ</td><td>ä¸ä½¿ç”¨ç¼“å­˜ï¼Œå…¨æ–°æ„å»º</td></tr>
<tr><td><code>verify</code></td><td>âœ… éªŒè¯ç¯å¢ƒ</td><td>&lt; 1 åˆ†é’Ÿ</td><td>å¿«é€Ÿæ£€æŸ¥ CI ç¼–è¯‘ç¯å¢ƒ</td></tr>
<tr><td><code>run-make</code></td><td>ğŸ”¨ ç¼–è¯‘ rclone</td><td>5-10 åˆ†é’Ÿ</td><td>åœ¨å®¹å™¨ä¸­è¿è¡Œ makeï¼Œç¼–è¯‘æºç </td></tr>
<tr><td><code>run</code></td><td>ğŸ–¥ï¸ äº¤äº’å¼ Shell</td><td>å³æ—¶</td><td>è¿›å…¥å®¹å™¨è¿›è¡Œäº¤äº’å¼æ“ä½œ</td></tr>
</table>

<h4>å¸¸è§ä½¿ç”¨åœºæ™¯</h4>

<p><strong>åœºæ™¯ 1ï¼šé¦–æ¬¡éƒ¨ç½²ï¼ˆå®Œæ•´éªŒè¯ï¼‰</strong></p>
<div class="code-block">cd ~/rclone
./docker-ci-commands.sh build  # ä¸€æ¡å‘½ä»¤ï¼Œå®Œæˆç³»ç»Ÿæ£€æŸ¥ + æ„å»º

# è¾“å‡ºç¤ºä¾‹ï¼š
# â„¹ï¸  ç¬¬ 1 æ­¥ï¼šç³»ç»Ÿç¯å¢ƒæ£€æŸ¥
#   âœ“ æ“ä½œç³»ç»Ÿ: Linux
#   âœ“ å†…æ ¸ç‰ˆæœ¬: 5.14.0
#   âœ“ å½“å‰ç”¨æˆ·: runner
# â„¹ï¸  ç¬¬ 2 æ­¥ï¼šDocker ç¯å¢ƒéªŒè¯
#   âœ“ Docker version 29.0.0
#   âœ“ Docker æœåŠ¡æ­£åœ¨è¿è¡Œ
# ... æ›´å¤šéªŒè¯æ­¥éª¤ ...
# âœ… rclone-ci é•œåƒæ„å»ºå®Œæˆï¼</div>

<p><strong>åœºæ™¯ 2ï¼šç¼–è¯‘æºä»£ç </strong></p>
<div class="code-block">cd ~/rclone
./docker-ci-commands.sh run-make  # åœ¨å®¹å™¨ä¸­ç¼–è¯‘ rclone

# è¾“å‡ºç¤ºä¾‹ï¼š
# ...
# make[1]: Leaving directory '/workspace'
# Build complete!
# Binary: /workspace/rclone</div>

<p><strong>åœºæ™¯ 3ï¼šå¿«é€Ÿç¯å¢ƒæ£€æŸ¥ï¼ˆæ— æ„å»ºï¼‰</strong></p>
<div class="code-block">cd ~/rclone
./docker-ci-commands.sh verify  # ä»…æ£€æŸ¥ï¼Œä¸æ„å»º

# è¾“å‡ºç¤ºä¾‹ï¼š
# âœ… rclone CI ç¯å¢ƒæ£€æŸ¥é€šè¿‡
# - gcc ç‰ˆæœ¬: gcc (GCC) 9.5.0
# - go ç‰ˆæœ¬: go version go1.21.0
# - make ç‰ˆæœ¬: GNU Make 4.3
# ...</div>

<p><strong>åœºæ™¯ 4ï¼šè¿›å…¥å®¹å™¨è°ƒè¯•</strong></p>
<div class="code-block">cd ~/rclone
./docker-ci-commands.sh run  # è¿›å…¥ bash

# ç°åœ¨åœ¨å®¹å™¨å†…ï¼Œå¯ä»¥è‡ªç”±æ“ä½œï¼š
runner@rclone:~$ gcc --version
gcc (Debian 10.2.1-6) 10.2.1 20210110
runner@rclone:~$ echo $GOPATH
/workspace/go
runner@rclone:~$ make   # æ‰‹åŠ¨ç¼–è¯‘
...</div>

<h4>é«˜çº§å‘½ä»¤å‚è€ƒ</h4>

<table>
<tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr>
<tr><td><code>setup</code></td><td>å®‰è£… Docker Engineï¼ˆä»…é¦–æ¬¡éœ€è¦ï¼‰</td></tr>
<tr><td><code>setup-mirrors</code></td><td>é…ç½®åŠ é€Ÿé•œåƒæºï¼ˆåŠ å¿«é•œåƒæ‹‰å–é€Ÿåº¦ï¼‰</td></tr>
<tr><td><code>images</code></td><td>æŸ¥çœ‹æœ¬åœ° Docker é•œåƒåˆ—è¡¨</td></tr>
<tr><td><code>inspect</code></td><td>æŸ¥çœ‹ rclone-ci é•œåƒè¯¦ç»†ä¿¡æ¯</td></tr>
<tr><td><code>logs</code></td><td>æŸ¥çœ‹å®¹å™¨è¿è¡Œæ—¥å¿—</td></tr>
<tr><td><code>stats</code></td><td>å®æ—¶ç›‘æ§å®¹å™¨èµ„æºä½¿ç”¨</td></tr>
<tr><td><code>rm</code></td><td>åˆ é™¤ rclone-ci é•œåƒ</td></tr>
<tr><td><code>cleanup</code></td><td>æ¸…ç†æ‰€æœ‰ Docker åŒ¿åæ•°æ®å·å’Œå®¹å™¨</td></tr>
</table>

<h3>ğŸš€ å¿«é€Ÿæ£€æŸ¥æ¸…å•</h3>

<p><strong>éƒ¨ç½²å‰</strong>ï¼š</p>
<div class="info-box info">
â˜ Rocky 9.4 ç³»ç»Ÿå·²å‡†å¤‡<br>
â˜ ç½‘ç»œå¯è®¿é—® GitHub<br>
â˜ ç›®å½•ç»“æ„å·²æŒ‰ ç›®å½•ç»“æ„å®‰æ’è¯´æ˜.md åˆ›å»º<br>
â˜ 5 ä¸ªæ ¸å¿ƒæ–‡ä»¶å·²å¤åˆ¶ï¼šDockerfile.ciã€docker-ci-commands.shã€verify-docker-runner.shã€.md æ–‡ä»¶ã€.yml å·¥ä½œæµ
</div>

<p><strong>éƒ¨ç½²ä¸­</strong>ï¼š</p>
<div class="code-block">cd ~/rclone
./docker-ci-commands.sh build  # è¿è¡Œä¸€æ¬¡ï¼Œè‡ªåŠ¨å®Œæˆæ‰€æœ‰å·¥ä½œ</div>

<p><strong>éƒ¨ç½²å</strong>ï¼š</p>
<div class="info-box success">
âœ… docker-ci-commands.sh build æˆåŠŸå®Œæˆ<br>
âœ… æœ¬åœ°éªŒè¯è„šæœ¬é€šè¿‡æ‰€æœ‰æ£€æŸ¥<br>
âœ… GitHub Actions å·¥ä½œæµé…ç½®å°±ç»ªï¼ˆå¯é€‰ï¼‰
</div>

</div>

<div id="section3">
<h2>3ï¸âƒ£ Docker CI æ–¹æ¡ˆ - å¿«é€Ÿå‚è€ƒæŒ‡å—</h2>

<h3>ğŸš€ å¿«é€Ÿå¼€å§‹ï¼ˆ3æ­¥ï¼‰</h3>
<div class="code-block"># 1. æ„å»ºé•œåƒï¼ˆé¦–æ¬¡5åˆ†é’Ÿï¼‰
docker build -f Dockerfile.ci -t rclone-ci:latest .

# 2. éªŒè¯ç¯å¢ƒ
docker run --rm rclone-ci:latest verify-ci-env

# 3. è¿è¡Œæ„å»º
docker run --rm -v "$(pwd)":/workspace -w /workspace rclone-ci:latest make</div>

<h3>ğŸ“¦ å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥</h3>

<h4>Docker é•œåƒæ“ä½œ</h4>
<table>
<tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr>
<tr><td>docker build -f Dockerfile.ci -t rclone-ci:latest .</td><td>æ„å»ºé•œåƒ</td></tr>
<tr><td>docker images | grep rclone-ci</td><td>æŸ¥çœ‹é•œåƒ</td></tr>
<tr><td>docker image rm rclone-ci:latest</td><td>åˆ é™¤é•œåƒ</td></tr>
<tr><td>docker image inspect rclone-ci:latest</td><td>æŸ¥çœ‹é•œåƒè¯¦æƒ…</td></tr>
<tr><td>docker history rclone-ci:latest</td><td>æŸ¥çœ‹æ„å»ºå±‚</td></tr>
</table>

<h4>Dockerfile.ci æ„å»ºæ­¥éª¤è¯¦è§£ï¼ˆå…± 19 æ­¥ï¼‰</h4>
<p><strong>è¯´æ˜</strong>: ä»¥ä¸‹æ˜¯é•œåƒæ„å»ºè¿‡ç¨‹ä¸­çš„å®Œæ•´æ­¥éª¤åˆ†è§£ã€‚æ‰€æœ‰ç”Ÿæˆçš„æ–‡ä»¶å‡ä½äº<code>Docker é•œåƒæ–‡ä»¶ç³»ç»Ÿ</code>å†…éƒ¨ï¼Œä¸ä¼šå½±å“å®¿ä¸»æœºã€‚</p>

<table>
<tr>
<th>#</th>
<th>æ­¥éª¤</th>
<th>æ“ä½œæè¿°</th>
<th>æ–‡ä»¶ä½ç½®ï¼ˆå®¹å™¨å†…ï¼‰</th>
<th>ç¼“å­˜çŠ¶æ€</th>
</tr>
<tr>
<td>1</td>
<td>FROM ubuntu:22.04</td>
<td>æ‹‰å–åŸºç¡€é•œåƒ</td>
<td><code>/</code> (æ‰€æœ‰æ–‡ä»¶)</td>
<td>CACHED</td>
</tr>
<tr>
<td>2</td>
<td>apt ca-certificates</td>
<td>å®‰è£…è¯ä¹¦ + æ—¶åŒºæ•°æ®</td>
<td><code>/usr/share/ca-certificates/</code></td>
<td>CACHED</td>
</tr>
<tr>
<td>3</td>
<td>ç¼–è¯‘å·¥å…·é“¾</td>
<td>gcc, g++, make, cmake, git ç­‰</td>
<td><code>/usr/bin/</code>, <code>/usr/lib/</code></td>
<td>CACHED</td>
</tr>
<tr>
<td>4</td>
<td>å¼€å‘åº“</td>
<td>python3-dev, libssl-dev ç­‰</td>
<td><code>/usr/include/</code>, <code>/usr/lib/</code></td>
<td>CACHED</td>
</tr>
<tr>
<td>5</td>
<td>æ–‡ä»¶ç³»ç»Ÿæ”¯æŒ</td>
<td>fuse3, nfs-common, btrfs-progs</td>
<td><code>/usr/lib/</code>, <code>/usr/bin/</code></td>
<td>CACHED</td>
</tr>
<tr>
<td>6</td>
<td>å¯é€‰å·¥å…·</td>
<td>vim, nano, htop, jq ç­‰</td>
<td><code>/usr/bin/</code>, <code>/usr/share/</code></td>
<td>CACHED</td>
</tr>
<tr>
<td>7</td>
<td>Go ç¼–ç¨‹ç¯å¢ƒ</td>
<td>go äºŒè¿›åˆ¶ + æ ‡å‡†åº“</td>
<td><code>/usr/lib/go-*</code>, <code>/usr/bin/go</code></td>
<td>CACHED</td>
</tr>
<tr>
<td>8</td>
<td>Go ç›®å½•é…ç½®</td>
<td>åˆ›å»º /root/go ç»“æ„</td>
<td><code>/root/go/</code></td>
<td>CACHED</td>
</tr>
<tr>
<td>9</td>
<td>Runner ä¾èµ–</td>
<td>å®‰è£… sudo, libicu70</td>
<td><code>/usr/lib/</code></td>
<td>CACHED</td>
</tr>
<tr>
<td>10</td>
<td>åˆ›å»º runner ç”¨æˆ·</td>
<td>æ–°å»ºç”¨æˆ· + sudoers é…ç½®</td>
<td><code>/etc/passwd</code>, <code>/etc/sudoers.d/</code></td>
<td>CACHED</td>
</tr>
<tr>
<td>11</td>
<td>FUSE é…ç½®</td>
<td>ä¿®æ”¹ /etc/fuse.conf</td>
<td><code>/etc/fuse.conf</code></td>
<td>CACHED</td>
</tr>
<tr>
<td>12</td>
<td>ç¯å¢ƒéªŒè¯</td>
<td>è¿è¡Œç‰ˆæœ¬æ£€æŸ¥å‘½ä»¤</td>
<td>(æ— æ–°æ–‡ä»¶ï¼Œä»…è¾“å‡º)</td>
<td>CACHED</td>
</tr>
<tr>
<td>13</td>
<td>æ¸…ç†ç¼“å­˜</td>
<td>åˆ é™¤ apt ç¼“å­˜ï¼Œå‡å°é•œåƒå¤§å°</td>
<td><code>/var/lib/apt/lists/</code> (åˆ é™¤)</td>
<td>CACHED</td>
</tr>
<tr>
<td>14</td>
<td>åˆ›å»ºå·¥ä½œç›®å½•</td>
<td>mkdir /workspace</td>
<td><code>/workspace/</code></td>
<td>CACHED</td>
</tr>
<tr>
<td>15</td>
<td>é…ç½®æ‰€æœ‰æƒ</td>
<td>chown -R runner:runner /workspace</td>
<td>(æƒé™æ”¹å˜)</td>
<td>CACHED</td>
</tr>
<tr>
<td>16</td>
<td>è®¾ç½®é»˜è®¤ç”¨æˆ·</td>
<td>USER runner</td>
<td>(è¿è¡Œä¸Šä¸‹æ–‡æ”¹å˜)</td>
<td>CACHED</td>
</tr>
<tr>
<td>17</td>
<td>å¥åº·æ£€æŸ¥é…ç½®</td>
<td>HEALTHCHECK å…ƒæ•°æ®</td>
<td>(é•œåƒå…ƒæ•°æ®)</td>
<td>CACHED</td>
</tr>
<tr>
<td>18</td>
<td>ENTRYPOINT è®¾ç½®</td>
<td>è®¾ç½®å®¹å™¨å…¥å£ç‚¹</td>
<td>(é•œåƒå…ƒæ•°æ®)</td>
<td>CACHED</td>
</tr>
<tr>
<td>19</td>
<td>CMD è®¾ç½®</td>
<td>è®¾ç½®é»˜è®¤å‘½ä»¤</td>
<td>(é•œåƒå…ƒæ•°æ®)</td>
<td>CACHED</td>
</tr>
</table>

<h4>å…³é”®è¯´æ˜</h4>
<div class="info-box info">
<strong>ğŸ“ æ–‡ä»¶ä½ç½®</strong><br>
â€¢ å®¹å™¨å†…è·¯å¾„: <code>/usr/bin/</code>, <code>/usr/lib/</code> ç­‰å‡æŒ‡å®¹å™¨æ–‡ä»¶ç³»ç»Ÿå†…éƒ¨<br>
â€¢ å®¿ä¸»æœºä½ç½®: <code>/var/lib/docker/overlay2/</code> (Docker å­˜å‚¨é©±åŠ¨)<br>
â€¢ æœ€ç»ˆé•œåƒ: <code>/var/lib/docker/image/overlay2/</code> (é•œåƒå…ƒæ•°æ®)
</div>

<div class="info-box warning">
<strong>â³ æ„å»ºæ—¶é—´å‚è€ƒ</strong><br>
â€¢ é¦–æ¬¡æ„å»ºï¼ˆæ— ç¼“å­˜ï¼‰: 3-5 åˆ†é’Ÿ<br>
â€¢ åç»­æ„å»ºï¼ˆå¸¦ç¼“å­˜ï¼‰: 10-30 ç§’<br>
â€¢ å¦‚å¡åœ¨ (16/19): å¯èƒ½åœ¨ä¸‹è½½ nfs-common æˆ– Goï¼Œè¯·ç¨ç­‰
</div>

<h4>Docker å®¹å™¨æ“ä½œ</h4>
<table>
<tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr>
<tr><td>docker run -it rclone-ci:latest bash</td><td>äº¤äº’å¼è¿è¡Œ</td></tr>
<tr><td>docker run --rm -v "$(pwd)":/workspace rclone-ci:latest make</td><td>ä¸€æ¬¡æ€§æ‰§è¡Œ</td></tr>
<tr><td>docker ps -a</td><td>æŸ¥çœ‹å®¹å™¨åˆ—è¡¨</td></tr>
<tr><td>docker logs &lt;container-id&gt;</td><td>æŸ¥çœ‹æ—¥å¿—</td></tr>
<tr><td>docker exec -it &lt;container-id&gt; bash</td><td>è¿›å…¥è¿è¡Œä¸­çš„å®¹å™¨</td></tr>
</table>

<h4>Docker Compose æ“ä½œ</h4>
<table>
<tr><th>å‘½ä»¤</th><th>è¯´æ˜</th></tr>
<tr><td>docker-compose up -d</td><td>å¯åŠ¨ç¯å¢ƒ</td></tr>
<tr><td>docker-compose exec runner bash</td><td>è¿›å…¥å®¹å™¨</td></tr>
<tr><td>docker-compose exec runner verify-ci-env</td><td>éªŒè¯ç¯å¢ƒ</td></tr>
<tr><td>docker-compose logs -f runner</td><td>æŸ¥çœ‹æ—¥å¿—</td></tr>
<tr><td>docker-compose down</td><td>åœæ­¢å¹¶ç§»é™¤å®¹å™¨</td></tr>
<tr><td>docker-compose down -v</td><td>åœæ­¢å¹¶åˆ é™¤å·</td></tr>
</table>

<h3>ğŸ”§ ç¯å¢ƒå˜é‡é…ç½®</h3>
<div class="code-block">export CGO_ENABLED=1
export GO111MODULE=on
export GOFLAGS="-v"
export GOCACHE=/root/.cache/go-build
export GOMODCACHE=/root/go/pkg/mod</div>

<h3>ğŸ› å¿«é€Ÿæ•…éšœæ’æŸ¥</h3>

<div class="info-box danger">
<strong>é•œåƒæ„å»ºå¤±è´¥</strong><br>
docker builder prune -a<br>
docker build -f Dockerfile.ci --progress=plain -t rclone-ci:latest .
</div>

<div class="info-box danger">
<strong>æƒé™é—®é¢˜</strong><br>
docker run --cap-add SYS_ADMIN --security-opt apparmor:unconfined --device /dev/fuse rclone-ci:latest verify-ci-env
</div>

<div class="info-box warning">
<strong>FUSE æŒ‚è½½å¤±è´¥</strong><br>
cat /etc/fuse.conf | grep user_allow_other<br>
sudo modprobe fuse
</div>

<h3>ğŸ“ å·¥ä½œæµé…ç½® Snippets</h3>

<h4>æœ€å°é…ç½®</h4>
<div class="code-block">jobs:
  build:
    runs-on: [self-hosted, linux, docker]
    container:
      image: rclone-ci:latest
    steps:
      - uses: actions/checkout@v4
      - run: make</div>

<h4>å®Œæ•´é…ç½®ï¼ˆæ ‡å‡†ï¼‰</h4>
<div class="code-block">jobs:
  build:
    runs-on: [self-hosted, linux, docker]
    container:
      image: rclone-ci:latest
      options: |
        --cpus 4
        --memory 8g
        -v /dev/fuse:/dev/fuse
        --cap-add SYS_ADMIN
      env:
        CGO_ENABLED: "1"
    timeout-minutes: 30
    steps:
      - uses: actions/checkout@v4
      - run: verify-ci-env
      - run: go mod download
      - run: make
      - uses: actions/upload-artifact@v4
        with:
          name: rclone-binary
          path: rclone</div>
</div>

<div id="section4">
<h2>4ï¸âƒ£ Docker æ–¹æ¡ˆï¼šGitHub Actions Runner éƒ¨ç½²æŒ‡å—</h2>

<h3>ğŸ“‹ æ¦‚è¿°</h3>
<p>æ­¤æ–¹æ¡ˆä½¿ç”¨ <strong>Docker å®¹å™¨</strong>æ›¿ä»£ä¹‹å‰çš„è£¸æœº Runner æ–¹æ¡ˆï¼Œè§£å†³ç¯å¢ƒå·®å¼‚é—®é¢˜ã€‚</p>

<h3>æ ¸å¿ƒä¼˜åŠ¿</h3>
<table>
<tr><th>æ–¹é¢</th><th>è£¸æœºæ–¹æ¡ˆ</th><th>Dockeræ–¹æ¡ˆ</th></tr>
<tr><td><strong>ç¯å¢ƒä¸€è‡´æ€§</strong></td><td>âŒ ä¾èµ–ç³»ç»Ÿç¯å¢ƒ</td><td>âœ… å®Œå…¨éš”ç¦»</td></tr>
<tr><td><strong>å¤æ‚åº¦</strong></td><td>âŒ å¤šä¸ª wrapper è„šæœ¬</td><td>âœ… å•ä¸ª Dockerfile</td></tr>
<tr><td><strong>å¯ç»´æŠ¤æ€§</strong></td><td>âŒ ç‰ˆæœ¬æ¼‚ç§»é£é™©</td><td>âœ… ç‰ˆæœ¬å›ºå®š</td></tr>
<tr><td><strong>å¯é‡ç°æ€§</strong></td><td>âŒ éš¾ä»¥å¤ç°</td><td>âœ… å®Œå…¨å¯é‡ç°</td></tr>
<tr><td><strong>å¿«é€Ÿéƒ¨ç½²</strong></td><td>âŒ ~30 åˆ†é’Ÿ</td><td>âœ… ~5 åˆ†é’Ÿ</td></tr>
<tr><td><strong>éš”ç¦»æ€§</strong></td><td>âŒ å…±äº«ä¸»æœºèµ„æº</td><td>âœ… å®¹å™¨éš”ç¦»</td></tr>
</table>

<h3>ğŸ”§ å¿«é€Ÿå¼€å§‹</h3>

<h4>å‰ç½®æ¡ä»¶</h4>
<ul>
<li><strong>æ“ä½œç³»ç»Ÿ</strong>: Rocky Linux 9.4 - 9.7 ï¼ˆæ¨èï¼‰æˆ–å…¶ä»– RHEL å…¼å®¹ç³»ç»Ÿ</li>
<li><strong>Docker Engine</strong> >= 20.10ï¼ˆé€šè¿‡æ¸…åæºå®‰è£…ï¼‰</li>
<li><strong>Docker Compose</strong> >= 2.0ï¼ˆé€šå¸¸ä¸ Docker Engine ä¸€èµ·å®‰è£…ï¼‰</li>
<li>è‡³å°‘ <strong>5GB</strong> å¯ç”¨ç£ç›˜ç©ºé—´</li>
</ul>

<h4>âœ… é‡è¦è¯´æ˜</h4>
<div class="info-box success">
<strong>æ—§æ–¹æ¡ˆå·²æ·˜æ±° - å®Œå…¨æ— éœ€ä»¥ä¸‹ä»»ä½•å·¥å…·ï¼š</strong><br>
âŒ apt-get wrapper è„šæœ¬<br>
âŒ JSON é…ç½®æ–‡ä»¶<br>
âŒ jq ä¾èµ–<br>
âœ… æ–° Docker æ–¹æ¡ˆå®Œå…¨ç‹¬ç«‹ï¼Œå¼€ç®±å³ç”¨ï¼
</div>

<h4>0ï¸âƒ£ å®‰è£… Docker Engineï¼ˆæ¸…åæº - Rocky 9.xï¼‰</h4>

<div class="code-block">#!/bin/bash
# åœ¨ Rocky Linux 9.x ç³»ç»Ÿä¸Šå¿«é€Ÿå®‰è£… Docker CEï¼ˆä½¿ç”¨æ¸…åæºï¼‰

# 1. ç§»é™¤æ—§ç‰ˆæœ¬ Docker
sudo dnf remove docker docker-client docker-client-latest docker-common 2>/dev/null || true

# 2. å®‰è£…å¿…è¦å·¥å…·
sudo dnf install -y dnf-plugins-core

# 3. é…ç½®æ¸…åæºï¼ˆå›½å†…è®¿é—®æ›´å¿«ï¼‰
sudo dnf config-manager --add-repo https://mirrors.tuna.tsinghua.edu.cn/docker-ce/linux/centos/docker-ce.repo

# 4. æ›´æ–°ç¼“å­˜
sudo dnf makecache

# 5. å®‰è£… Docker CEã€CLIã€Compose ç­‰
sudo dnf install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin

# 6. å¯åŠ¨å’Œå¯ç”¨ Docker æœåŠ¡
sudo systemctl start docker
sudo systemctl enable docker

# 7. éªŒè¯å®‰è£…
docker --version
docker-compose --version</div>

<h4>0ï¸âƒ£ Docker é•œåƒæºæ£€æµ‹ä¸è‡ªåŠ¨é…ç½®</h4>

<p><strong>é—®é¢˜</strong>: Docker é•œåƒæ‹‰å–ç¼“æ…¢ï¼ˆå°¤å…¶å›½å†…ç½‘ç»œï¼‰<br>
<strong>è§£å†³</strong>: ä½¿ç”¨ä»¥ä¸‹è„šæœ¬è‡ªåŠ¨æ£€æµ‹æœ€å¿«çš„é•œåƒæºï¼Œå¹¶é…ç½®åˆ° Docker

<div class="code-block">#!/usr/bin/env bash
set -euo pipefail

OUT="mirror_check_$(date +%Y%m%d_%H%M%S).csv"
echo "mirror,endpoint,http_code,time_total,size_download" > "$OUT"

# å¯ç¼–è¾‘çš„é•œåƒåŠ é€Ÿå™¨åˆ—è¡¨
mirrors=(
  "https://docker.mirrors.ustc.edu.cn"
  "https://hub-mirror.c.163.com"
  "https://registry.docker-cn.com"
  "https://mirrors.aliyun.com"
  "https://hub-mirror.baidubce.com"
)

endpoints=("" "/v2/" "/_ping")

# è¿è¡Œæ£€æŸ¥
for m in "${mirrors[@]}"; do
  for e in "${endpoints[@]}"; do
    url="${m%/}${e}"
    out=$(curl -sS -L --max-time 10 --connect-timeout 5 -w "%{http_code},%{time_total},%{size_download}" -o /dev/null "$url" 2>/dev/null) || out="000,0,0"
    echo "$m,$e,$out" >> "$OUT"
    http_code=$(echo $out | cut -d, -f1)
    [ "$http_code" = "200" ] && echo "âœ… $url: HTTP $http_code"
  done
done

# é€‰æ‹©ç¬¬ä¸€ä¸ªè¿”å› 200 çš„é•œåƒæºå¹¶è‡ªåŠ¨é…ç½®
good_mirror=$(grep ',200,' "$OUT" | head -1 | cut -d, -f1)

if [ -n "$good_mirror" ]; then
  echo ""
  echo "é€‰æ‹©é•œåƒæº: $good_mirror"
  sudo mkdir -p /etc/docker
  sudo tee /etc/docker/daemon.json > /dev/null <<EOF
{
  "registry-mirrors": ["$good_mirror"],
  "log-driver": "json-file",
  "log-opts": {
    "max-size": "10m",
    "max-file": "3"
  }
}
EOF
  
  sudo systemctl daemon-reload
  sudo systemctl restart docker
  
  echo "âœ… é…ç½®å®Œæˆï¼Docker å·²é‡å¯"
  docker info | grep -A 3 "Registry Mirrors"
else
  echo "âŒ æœªæ‰¾åˆ°æœ‰æ•ˆçš„é•œåƒæºï¼Œè¯·æ£€æŸ¥ç½‘ç»œ"
  exit 1
fi</div>

<p><strong>ä½¿ç”¨æ­¥éª¤</strong>:</p>
<ol>
<li>ä¿å­˜ä¸Šé¢çš„è„šæœ¬ä¸º <code>setup-docker-mirrors.sh</code></li>
<li>èµ‹äºˆæ‰§è¡Œæƒé™: <code>chmod +x setup-docker-mirrors.sh</code></li>
<li>è¿è¡Œè„šæœ¬: <code>./setup-docker-mirrors.sh</code></li>
<li>è„šæœ¬ä¼šè‡ªåŠ¨æ£€æµ‹å¹¶é…ç½®æœ€å¿«çš„é•œåƒæº</li>
</ol>

<h4>1ï¸âƒ£ æœ¬åœ°æµ‹è¯•ï¼ˆä½¿ç”¨ Docker Composeï¼‰</h4>
<div class="code-block">cd /path/to/rclone

# å¯åŠ¨ CI ç¯å¢ƒï¼ˆé¦–æ¬¡ä¼šæ‹‰å–é•œåƒï¼Œéœ€è¦å‡ åˆ†é’Ÿï¼‰
docker-compose up -d

# éªŒè¯ç¯å¢ƒï¼ˆæ£€æŸ¥æ‰€æœ‰ä¾èµ–ï¼‰
docker-compose exec runner verify-ci-env

# è¿›å…¥å®¹å™¨è¿›è¡Œå¼€å‘
docker-compose exec runner bash

# æŸ¥çœ‹å®¹å™¨æ—¥å¿—
docker-compose logs -f runner

# åœæ­¢ç¯å¢ƒå¹¶æ¸…ç†å·
docker-compose down -v</div>

<h4>2ï¸âƒ£ æ„å»ºé•œåƒ</h4>
<div class="code-block">docker build -f Dockerfile.ci -t rclone-ci:latest .
docker run --rm rclone-ci:latest verify-ci-env
docker images rclone-ci</div>

<h4>3ï¸âƒ£ è¿è¡Œå®¹å™¨</h4>
<div class="code-block"># äº¤äº’å¼è¿è¡Œ
docker run -it --rm \
  -v "$(pwd)":/workspace \
  -w /workspace \
  rclone-ci:latest bash

# ä¸€æ¬¡æ€§æ‰§è¡Œå‘½ä»¤
docker run --rm \
  -v "$(pwd)":/workspace \
  -w /workspace \
  rclone-ci:latest \
  bash -c "go version && make test"</div>

<h3>ğŸ“¦ ç”Ÿäº§éƒ¨ç½²</h3>

<h4>æ–¹æ¡ˆ Aï¼šRunner æœºå™¨ä½¿ç”¨ Dockerï¼ˆå®Œå…¨å®¹å™¨åŒ–ï¼‰</h4>
<p>æ­¤æ–¹æ¡ˆå°† GitHub Actions Runner æœ¬èº«ä¹Ÿè¿è¡Œåœ¨å®¹å™¨ä¸­ã€‚</p>

<h4>æ–¹æ¡ˆ Bï¼šRunner åœ¨å®¿ä¸»æœºï¼ŒJob åœ¨å®¹å™¨ä¸­ï¼ˆæ¨èæ··åˆæ–¹æ¡ˆï¼‰</h4>
<p>æ­¤æ–¹æ¡ˆå°† Runner ä¿æŒåœ¨å®¿ä¸»æœºï¼Œä½†æ¯ä¸ª Job åœ¨å®¹å™¨ä¸­æ‰§è¡Œï¼ˆæœ€çµæ´»çš„æ–¹æ¡ˆï¼‰ã€‚</p>

<h4>å·¥ä½œæµé…ç½®</h4>
<div class="code-block">name: Build rclone
on: [push]

jobs:
  build:
    runs-on: [self-hosted, linux, docker]
    container:
      image: rclone-ci:latest
      options: --cpus 4 --memory 8g
      volumes:
        - /dev/fuse:/dev/fuse
      env:
        CGO_ENABLED: "1"
    
    steps:
      - uses: actions/checkout@v4
      - name: Verify CI environment
        run: verify-ci-env
      - name: Download dependencies
        run: go mod download
      - name: Build rclone
        run: make
      - name: Run tests
        run: make test
      - name: Upload artifacts
        uses: actions/upload-artifact@v4
        with:
          name: rclone-binary
          path: rclone
          retention-days: 30</div>

<h3>ğŸ”§ æ•…éšœæ’æŸ¥</h3>

<div class="info-box danger">
<strong>é—®é¢˜ 1: é•œåƒæ„å»ºå¤±è´¥</strong><br>
<strong>ç—‡çŠ¶</strong>: docker build -f Dockerfile.ci ... è¿”å›é”™è¯¯<br>
<strong>è§£å†³æ­¥éª¤</strong>:<br>
1. æ£€æŸ¥ç½‘ç»œè¿æ¥: ping 8.8.8.8<br>
2. å¢åŠ  Docker æ„å»ºæ—¥å¿—è¯¦åº¦: docker build -f Dockerfile.ci --progress=plain -t rclone-ci:latest .<br>
3. æ¸…ç† Docker ç¼“å­˜åé‡è¯•: docker builder prune -a && docker build -f Dockerfile.ci -t rclone-ci:latest .
</div>

<div class="info-box danger">
<strong>é—®é¢˜ 2: å®¹å™¨è¿è¡Œæ—¶æƒé™ä¸è¶³</strong><br>
<strong>ç—‡çŠ¶</strong>: Permission denied æˆ– operation not permitted<br>
<strong>è§£å†³æ–¹æ¡ˆ</strong>:<br>
docker run --rm --cap-add SYS_ADMIN --security-opt apparmor:unconfined --device /dev/fuse rclone-ci:latest verify-ci-env
</div>

<div class="info-box warning">
<strong>é—®é¢˜ 3: ç¼–è¯‘é€Ÿåº¦ç¼“æ…¢</strong><br>
<strong>ç—‡çŠ¶</strong>: go build æˆ– make å‘½ä»¤è€—æ—¶è¿‡é•¿<br>
<strong>ä¼˜åŒ–æ–¹æ¡ˆ</strong>:<br>
1. ä½¿ç”¨ Docker Compose ä¸­å®šä¹‰çš„å·ç¼“å­˜<br>
2. é¢„çƒ­ Go modules ç¼“å­˜: docker-compose exec runner go mod download<br>
3. ä½¿ç”¨å¤šæ ¸ç¼–è¯‘: docker run --rm -e GOMAXPROCS=8 rclone-ci:latest bash -c "go build -p 8"
</div>

<h3>âœ¨ æœ€ä½³å®è·µ</h3>

<h4>1. é•œåƒå¤§å°ä¼˜åŒ–</h4>
<p>å½“å‰ Dockerfile å¯èƒ½äº§ç”Ÿçº¦ 1GB çš„é•œåƒï¼Œå¯ä»¥é€šè¿‡å¤šé˜¶æ®µæ„å»ºè¿›ä¸€æ­¥ä¼˜åŒ–ã€‚</p>

<h4>2. ç¼“å­˜ç­–ç•¥</h4>
<div class="code-block"># âœ… é¢„åŠ è½½ç¼“å­˜ï¼ˆå‰ç½®å·¥ä½œï¼‰
docker-compose up -d
docker-compose exec runner go mod download
docker-compose down

# âœ… GitHub Actions ä¸­ä½¿ç”¨ç¼“å­˜ Action
- uses: actions/cache@v4
  with:
    path: |
      /root/.cache/go-build
      /root/go/pkg/mod
    key: ${{ runner.os }}-go-${{ hashFiles('**/go.sum') }}</div>

<h4>3. å®‰å…¨æ€§æœ€ä½³å®è·µ</h4>
<div class="code-block"># âœ… ä½¿ç”¨ç‰¹å®šç‰ˆæœ¬æ ‡ç­¾
docker run rclone-ci:v1.0.0  # âœ… å¥½

docker run rclone-ci:latest  # âš ï¸ ä¸æ¨èç”¨äºç”Ÿäº§</div>

<h4>4. ç›‘æ§å’Œæ—¥å¿—</h4>
<div class="code-block">docker logs github-actions-runner
docker stats github-actions-runner
docker exec -it github-actions-runner bash</div>

<h4>5. æ›´æ–°é•œåƒ</h4>
<div class="code-block">docker build -f Dockerfile.ci --no-cache -t rclone-ci:latest .</div>
</div>

<div id="section5">
<h2>5ï¸âƒ£ ä»è£¸æœºæ–¹æ¡ˆè¿ç§»åˆ° Docker æ–¹æ¡ˆ</h2>

<h3>ä¸ºä»€ä¹ˆè¦è¿ç§»ï¼Ÿ</h3>

<h4>è£¸æœºæ–¹æ¡ˆçš„é—®é¢˜ (v3.1)</h4>
<table>
<tr><th>é—®é¢˜</th><th>å½±å“</th></tr>
<tr><td><strong>å¤šè„šæœ¬ä¾èµ–</strong></td><td>5+ ä¸ªè„šæœ¬ï¼ˆapt-get wrapperã€JSON é…ç½®ã€jqã€verify-env ç­‰ï¼‰</td></tr>
<tr><td><strong>ç¯å¢ƒæ¼‚ç§»</strong></td><td>ç³»ç»Ÿæ›´æ–°å¯¼è‡´ç¯å¢ƒå˜åŒ–ï¼Œéš¾ä»¥è°ƒè¯•</td></tr>
<tr><td><strong>ç»´æŠ¤å¤æ‚</strong></td><td>ä¿®æ”¹ä¸€ä¸ªåŒ…éœ€è¦æ›´æ–° JSONã€å¯èƒ½é‡å»ºç³»ç»Ÿ</td></tr>
<tr><td><strong>åˆå§‹åŒ–è€—æ—¶</strong></td><td>é¦–æ¬¡éƒ¨ç½²éœ€è¦ 30+ åˆ†é’Ÿ</td></tr>
</table>

<h4>Docker æ–¹æ¡ˆçš„ä¼˜åŠ¿</h4>
<ul>
<li>âœ… <strong>ä¸€ä¸ª Dockerfile</strong> å®šä¹‰æ•´ä¸ªç¯å¢ƒ</li>
<li>âœ… <strong>å®Œå…¨éš”ç¦»</strong> é¿å…ç³»ç»Ÿç¯å¢ƒå½±å“</li>
<li>âœ… <strong>å¿«é€Ÿéƒ¨ç½²</strong> 5 åˆ†é’Ÿå®Œæˆé•œåƒæ„å»º</li>
<li>âœ… <strong>å®¹æ˜“ç»´æŠ¤</strong> ä¿®æ”¹åªéœ€è°ƒæ•´ Dockerfile</li>
<li>âœ… <strong>æœ¬åœ°å¤ç°</strong> åŒæ ·çš„é•œåƒåœ¨ä»»ä½•æœºå™¨ä¸Šè¿è¡Œç›¸åŒ</li>
<li>âœ… <strong>æ ‡å‡†åŒ–</strong> ç”± GitHub å®˜æ–¹æ¨èçš„æ–¹æ¡ˆ</li>
</ul>

<h3>ğŸ”„ è¿ç§»æ—¶é—´è¡¨</h3>
<div class="code-block">Phase 1: å‡†å¤‡ï¼ˆ1-2 å¤©ï¼‰
  â”œâ”€ åˆ›å»º Dockerfile.ci âœ“
  â”œâ”€ åˆ›å»º docker-compose.yml âœ“
  â”œâ”€ éªŒè¯æœ¬åœ°æ„å»º
  â””â”€ å‡†å¤‡å·¥ä½œæµæ–‡ä»¶

Phase 2: æµ‹è¯•ï¼ˆ2-3 å¤©ï¼‰
  â”œâ”€ åˆ›å»ºåŠŸèƒ½åˆ†æ”¯æµ‹è¯•
  â”œâ”€ è¿è¡Œç¤ºä¾‹å·¥ä½œæµ
  â”œâ”€ éªŒè¯æ„å»ºç‰©
  â””â”€ å¯¹æ¯”æ€§èƒ½

Phase 3: ä¸Šçº¿ï¼ˆ1 å¤©ï¼‰
  â”œâ”€ æ›´æ–°ä¸»å·¥ä½œæµ
  â”œâ”€ ç›‘æ§ CI æ—¥å¿—
  â””â”€ éªŒè¯æ„å»ºç¨³å®šæ€§

Phase 4: æ¸…ç†ï¼ˆ1 å¤©ï¼‰
  â”œâ”€ åˆ é™¤æ—§è„šæœ¬
  â”œâ”€ åˆ é™¤é…ç½®æ–‡ä»¶
  â”œâ”€ æ›´æ–°æ–‡æ¡£
  â””â”€ å½’æ¡£æ—§é…ç½®</div>

<h3>ğŸ“ åˆ†æ­¥è¿ç§»æŒ‡å—</h3>

<h4>Step 1: éªŒè¯ Docker ç¯å¢ƒ</h4>
<div class="code-block">docker --version        # åº”ä¸º >= 20.10
docker-compose --version  # åº”ä¸º >= 2.0
df -h | grep -E "/$|/home"  # è‡³å°‘ 10GB å¯ç”¨</div>

<h4>Step 2: æœ¬åœ°æ„å»ºé•œåƒ</h4>
<div class="code-block">cd /path/to/rclone
docker build -f Dockerfile.ci -t rclone-ci:latest .</div>

<h4>Step 3: éªŒè¯é•œåƒ</h4>
<div class="code-block">docker run --rm rclone-ci:latest verify-ci-env
# é¢„æœŸè¾“å‡ºåº”è¯¥çœ‹åˆ°ï¼šâœ… CI ENVIRONMENT VERIFICATION PASSED</div>

<h4>Step 4: æœ¬åœ°ç¼–è¯‘æµ‹è¯•</h4>
<div class="code-block">docker-compose up -d
docker-compose exec runner bash -c "cd /workspace && make"
docker-compose down</div>

<h4>Step 5: åˆ›å»ºæµ‹è¯•åˆ†æ”¯</h4>
<div class="code-block">git checkout -b test/docker-ci
git push origin test/docker-ci</div>

<h4>Step 6: éªŒè¯å·¥ä½œæµ</h4>
<p>åœ¨ GitHub Actions ä¸­æŸ¥çœ‹æµ‹è¯•åˆ†æ”¯çš„å·¥ä½œæµè¿è¡Œæƒ…å†µã€‚</p>

<h4>Step 7: åˆå¹¶åˆ°ä¸»åˆ†æ”¯</h4>
<div class="code-block">git checkout main
git merge test/docker-ci
git push origin main</div>

<h3>âœ… éªŒè¯æ£€æŸ¥æ¸…å•</h3>

<h4>æœ¬åœ°éªŒè¯</h4>
<ul>
<li>â˜ Docker å’Œ docker-compose å·²å®‰è£…</li>
<li>â˜ docker build -f Dockerfile.ci ... æˆåŠŸ</li>
<li>â˜ docker run --rm rclone-ci:latest verify-ci-env å…¨éƒ¨é€šè¿‡</li>
<li>â˜ docker-compose up && make æˆåŠŸç¼–è¯‘</li>
<li>â˜ ç¼–è¯‘è¾“å‡ºçš„ rclone å¯æ‰§è¡Œæ–‡ä»¶æ­£å¸¸è¿è¡Œ</li>
</ul>

<h4>å·¥ä½œæµéªŒè¯</h4>
<ul>
<li>â˜ GitHub Actions å·¥ä½œæµå·²æ›´æ–°ï¼ˆcontainer é…ç½®ï¼‰</li>
<li>â˜ æµ‹è¯•åˆ†æ”¯çš„å·¥ä½œæµæˆåŠŸè¿è¡Œï¼ˆ> 1 æ¬¡ï¼‰</li>
<li>â˜ ç¼–è¯‘æ—¶é—´ç¨³å®šï¼ˆ5-15 åˆ†é’Ÿï¼‰</li>
<li>â˜ Artifacts æ­£ç¡®ä¸Šä¼ </li>
<li>â˜ æµ‹è¯•ç”¨ä¾‹å…¨éƒ¨é€šè¿‡ï¼ˆå¦‚æœ‰ï¼‰</li>
</ul>

<h3>ğŸ”™ å›æ»šè®¡åˆ’</h3>
<p>å¦‚æœéœ€è¦å›åˆ°è£¸æœºæ–¹æ¡ˆï¼Œå¯ä»¥å¿«é€Ÿæ¢å¤ï¼š</p>
<div class="code-block">git checkout before-docker-migration -- .github/workflows/
sudo systemctl restart actions-runner</div>

<h3>â“ å¸¸è§é—®é¢˜</h3>

<div class="info-box info">
<strong>Q: è¿ç§»åï¼Œæœ¬åœ°å¼€å‘æ˜¯å¦å—å½±å“ï¼Ÿ</strong><br>
<strong>A</strong>: ä¸å—å½±å“ã€‚Docker æ–¹æ¡ˆåªå½±å“ CI/CD æµç¨‹ã€‚æœ¬åœ°å¼€å‘ç¯å¢ƒï¼ˆå¦‚ä½ çš„ macOS/Windowsï¼‰å¯ç»§ç»­ä½¿ç”¨ç°æœ‰è®¾ç½®ã€‚
</div>

<div class="info-box info">
<strong>Q: Docker é•œåƒéœ€è¦å¤šä¹…æ›´æ–°ä¸€æ¬¡ï¼Ÿ</strong><br>
<strong>A</strong>: å®‰å…¨è¡¥ä¸å»ºè®®æ¯æœˆæ›´æ–°ä¸€æ¬¡ã€‚å·¥å…·ç‰ˆæœ¬æ ¹æ®éœ€è¦æ›´æ–°ã€‚
</div>

<div class="info-box info">
<strong>Q: Docker é•œåƒå ç”¨å¤šå°‘ç©ºé—´ï¼Ÿ</strong><br>
<strong>A</strong>: é•œåƒçº¦ 1.5GBï¼ŒåŠ ä¸Šç¼“å­˜çº¦ 3.5GB æ€»è®¡ã€‚
</div>

<div class="info-box info">
<strong>Q: æ”¯æŒå“ªäº›æ¶æ„ï¼Ÿ</strong><br>
<strong>A</strong>: å½“å‰é’ˆå¯¹ x86_64ï¼ˆAMD64ï¼‰ã€‚å¯ä½¿ç”¨ docker buildx æ”¯æŒå¤šå¹³å°ã€‚
</div>
</div>

<div id="section6">
<h2>6ï¸âƒ£ Docker CI/CD æ–¹æ¡ˆ - èµ„æºæ€»è§ˆ</h2>

<h3>ğŸ“Œ å¿«é€Ÿå¯¼èˆª</h3>

<h4>ğŸš€ æ–°æ‰‹å…¥é—¨</h4>
<ul>
<li><strong>é¦–æ¬¡ä½¿ç”¨ï¼Ÿ</strong> â†’ å¿«é€Ÿå¼€å§‹ï¼ˆ5åˆ†é’Ÿï¼‰</li>
<li><strong>è¯¦ç»†æ­¥éª¤ï¼Ÿ</strong> â†’ å®Œæ•´éƒ¨ç½²æŒ‡å—</li>
<li><strong>é€ŸæŸ¥è¡¨ï¼Ÿ</strong> â†’ å¿«é€Ÿå‚è€ƒ</li>
</ul>

<h4>ğŸ”„ ä»æ—§æ–¹æ¡ˆè¿ç§»</h4>
<ul>
<li><strong>ä»è£¸æœºåˆ° Docker</strong> â†’ è¿ç§»æŒ‡å—</li>
<li><strong>åˆ†æ­¥éª¤è¿ç§»åœ°å›¾</strong> â†’ è¿ç§»æ—¶é—´è¡¨</li>
</ul>

<h4>ğŸ”§ å‘½ä»¤å’Œå·¥å…·</h4>
<ul>
<li><strong>å¸¸ç”¨ Docker å‘½ä»¤</strong> â†’ docker-ci-commands.sh</li>
<li><strong>å‘½ä»¤é€ŸæŸ¥</strong> â†’ å¿«é€Ÿå‚è€ƒ</li>
</ul>

<h4>â“ é‡åˆ°é—®é¢˜</h4>
<ul>
<li><strong>æ•…éšœæ’æŸ¥</strong> â†’ éƒ¨ç½²æŒ‡å—</li>
<li><strong>å¸¸è§é—®é¢˜</strong> â†’ è¿ç§»æŒ‡å—</li>
</ul>

<h3>ğŸ“‚ æ–‡ä»¶ç»“æ„è¯´æ˜</h3>
<div class="code-block">rclone/
â”œâ”€â”€ Dockerfile.ci                     # CI ä¸“ç”¨ Dockerfile
â”œâ”€â”€ docker-compose.yml                # æœ¬åœ°å¼€å‘é…ç½®
â”œâ”€â”€ docker-ci-commands.sh             # ä¾¿æ·å·¥å…·è„šæœ¬
â”œâ”€â”€ .github/workflows/
â”‚   â””â”€â”€ docker-build.yml              # GitHub Actions å·¥ä½œæµ
â””â”€â”€ é™„å½•/
    â”œâ”€â”€ Dockeræ–¹æ¡ˆéƒ¨ç½²æŒ‡å—.md         # å®Œæ•´éƒ¨ç½²æ–‡æ¡£
    â”œâ”€â”€ Dockerå¿«é€Ÿå‚è€ƒ.md             # é€ŸæŸ¥è¡¨
    â”œâ”€â”€ è¿ç§»æŒ‡å—-ä»è£¸æœºåˆ°Docker.md    # è¿ç§»æ­¥éª¤
    â””â”€â”€ Docker_CIèµ„æºæ€»è§ˆ.md          # èµ„æºå¯¼èˆª</div>

<h3>ğŸ”‘ æ ¸å¿ƒæ–‡ä»¶è¯´æ˜</h3>

<h4>Dockerfile.ci - CI ç¼–è¯‘ç¯å¢ƒå®šä¹‰</h4>
<ul>
<li><strong>ç”¨é€”</strong>: å®šä¹‰ CI ç¼–è¯‘ç¯å¢ƒ</li>
<li><strong>ç‰¹ç‚¹</strong>: åŸºäº Rocky Linux 9.4ï¼ŒåŒ…å« Go ç¼–è¯‘ç¯å¢ƒã€æ‰€æœ‰å¼€å‘åº“ã€FUSE æ”¯æŒ</li>
<li><strong>å¤§å°</strong>: çº¦ 1.5 GB</li>
<li><strong>æ„å»º</strong>: docker build -f Dockerfile.ci -t rclone-ci:latest .</li>
</ul>

<h4>docker-compose.yml - æœ¬åœ°å¼€å‘å’Œæµ‹è¯•</h4>
<ul>
<li><strong>ç”¨é€”</strong>: æœ¬åœ°å¼€å‘å’Œæµ‹è¯•</li>
<li><strong>ç‰¹ç‚¹</strong>: ä¸€é”®å¯åŠ¨å®Œæ•´å¼€å‘ç¯å¢ƒï¼Œè‡ªåŠ¨æŒ‚è½½ä»£ç å·ã€ç¼“å­˜å·ã€FUSE è®¾å¤‡</li>
<li><strong>ä½¿ç”¨</strong>: docker-compose up -d && docker-compose exec runner bash</li>
</ul>

<h4>.github/workflows/docker-build.yml - GitHub Actions é…ç½®</h4>
<ul>
<li><strong>ç”¨é€”</strong>: GitHub Actions å·¥ä½œæµé…ç½®</li>
<li><strong>ç‰¹ç‚¹</strong>: å®Œæ•´çš„æ„å»ºã€æµ‹è¯•ã€ä¸Šä¼ å·¥ä»¶æµç¨‹ï¼ŒåŒ…å«ç¼“å­˜ç­–ç•¥</li>
<li><strong>é›†æˆ</strong>: å¤åˆ¶åˆ° .github/workflows/ æˆ–åˆå¹¶å†…å®¹åˆ°ç°æœ‰å·¥ä½œæµ</li>
</ul>

<h3>ğŸ“Š å¯¹æ¯”ï¼šDocker vs è£¸æœºæ–¹æ¡ˆ</h3>
<table>
<tr><th>æŒ‡æ ‡</th><th>è£¸æœºæ–¹æ¡ˆï¼ˆv3.1ï¼‰</th><th>Docker æ–¹æ¡ˆ</th></tr>
<tr><td><strong>ç¯å¢ƒå®šä¹‰</strong></td><td>5+ ä¸ªè„šæœ¬ + JSON é…ç½®</td><td>1 ä¸ª Dockerfile</td></tr>
<tr><td><strong>åˆæ¬¡éƒ¨ç½²</strong></td><td>30-40 åˆ†é’Ÿ</td><td>5-10 åˆ†é’Ÿ</td></tr>
<tr><td><strong>ç£ç›˜å ç”¨</strong></td><td>2-3 GB</td><td>1.5 GBï¼ˆé•œåƒï¼‰+ ç¼“å­˜</td></tr>
<tr><td><strong>ç¯å¢ƒä¸€è‡´æ€§</strong></td><td>âš ï¸ æ˜“æ¼‚ç§»</td><td>âœ… å®Œå…¨éš”ç¦»</td></tr>
<tr><td><strong>å¯ç»´æŠ¤æ€§</strong></td><td>âš ï¸ å¤æ‚</td><td>âœ… ç®€æ´</td></tr>
<tr><td><strong>è„šæœ¬ä¾èµ–</strong></td><td>apt-get wrapper, jq</td><td>Docker Engine</td></tr>
<tr><td><strong>å­¦ä¹ æˆæœ¬</strong></td><td>é«˜ï¼ˆè‡ªå®šä¹‰ï¼‰</td><td>ä½ï¼ˆæ ‡å‡†æ–¹æ¡ˆï¼‰</td></tr>
</table>

<h3>ğŸ¯ ä½¿ç”¨åœºæ™¯</h3>

<h4>åœºæ™¯ 1ï¼šé¦–æ¬¡å°è¯•ï¼ˆ5åˆ†é’Ÿï¼‰</h4>
<div class="code-block">docker build -f Dockerfile.ci -t rclone-ci:latest .
docker run --rm rclone-ci:latest verify-ci-env
docker run --rm -v "$(pwd)":/workspace -w /workspace rclone-ci:latest make</div>

<h4>åœºæ™¯ 2ï¼šæœ¬åœ°å¼€å‘ï¼ˆæŒç»­å·¥ä½œï¼‰</h4>
<div class="code-block">docker-compose up -d
docker-compose exec runner bash
# ç¼–ç ã€æ„å»ºã€æµ‹è¯•...
docker-compose down</div>

<h4>åœºæ™¯ 3ï¼šGitHub Actions CIï¼ˆè‡ªåŠ¨è¿è¡Œï¼‰</h4>
<p>ä½¿ç”¨ .github/workflows/docker-build.yml é…ç½®</p>

<h3>ğŸ’¡ æœ€ä½³å®è·µå»ºè®®</h3>

<h4>1. ç¼“å­˜ç­–ç•¥</h4>
<ul>
<li>é¢„åŠ è½½ç¼“å­˜ï¼ˆå‰ç½®å·¥ä½œï¼‰</li>
<li>GitHub Actions ä¸­ä½¿ç”¨ cache Action</li>
</ul>

<h4>2. ç‰ˆæœ¬æ§åˆ¶</h4>
<ul>
<li>ä½¿ç”¨ç‰¹å®šç‰ˆæœ¬æ ‡ç­¾ï¼ˆå¦‚ v1.0.0ï¼‰</li>
<li>æ¨é€åˆ°ç§æœ‰ä»“åº“</li>
</ul>

<h4>3. ç›‘æ§å’Œæ—¥å¿—</h4>
<ul>
<li>å¸¸è§„ç›‘æ§: docker stats</li>
<li>æ·±åº¦è¯Šæ–­: docker inspect</li>
<li>GitHub Actions ä¸­å¯ç”¨è°ƒè¯•æ—¥å¿—</li>
</ul>

<h4>4. å®šæœŸæ›´æ–°</h4>
<ul>
<li>æœˆåº¦å®‰å…¨æ›´æ–°</li>
<li>ä¿å­˜æ›´æ–°æ—¥å¿—</li>
</ul>

<h3>ğŸ”— ç›¸å…³èµ„æº</h3>

<h4>å®˜æ–¹æ–‡æ¡£</h4>
<ul>
<li><a href="https://docs.docker.com/">ğŸ³ Docker å®˜æ–¹æ–‡æ¡£</a></li>
<li><a href="https://docs.docker.com/compose/">ğŸš€ Docker Compose æ–‡æ¡£</a></li>
<li><a href="https://docs.github.com/en/actions">ğŸ¤– GitHub Actions æ–‡æ¡£</a></li>
<li><a href="https://github.com/rclone/rclone#building">ğŸ› ï¸ rclone æ„å»ºæŒ‡å—</a></li>
<li><a href="https://docs.rockylinux.org/">ğŸ§ Rocky Linux æ–‡æ¡£</a></li>
</ul>

<h3>ğŸ“ˆ è¿ç§»å¿«é€Ÿæ£€æŸ¥</h3>

<h4>âœ… è¿ç§»å‰ï¼ˆç¡®è®¤å·²å®Œæˆï¼‰</h4>
<ul>
<li>â˜ Docker å’Œ docker-compose å·²å®‰è£…</li>
<li>â˜ docker build -f Dockerfile.ci ... æˆåŠŸ</li>
<li>â˜ docker run --rm rclone-ci:latest verify-ci-env é€šè¿‡</li>
<li>â˜ æœ¬åœ°æµ‹è¯•ç¼–è¯‘æˆåŠŸ</li>
</ul>

<h4>âœ… è¿ç§»ä¸­ï¼ˆè¡ŒåŠ¨é¡¹ï¼‰</h4>
<ul>
<li>â˜ åˆ›å»ºåŠŸèƒ½åˆ†æ”¯æµ‹è¯•</li>
<li>â˜ æ›´æ–° GitHub Actions å·¥ä½œæµ</li>
<li>â˜ è¿è¡Œå·¥ä½œæµéªŒè¯</li>
<li>â˜ å¤‡ä»½æ—§é…ç½®</li>
</ul>

<h4>âœ… è¿ç§»åï¼ˆæ¸…ç†ï¼‰</h4>
<ul>
<li>â˜ åˆ é™¤æ—§çš„è„šæœ¬</li>
<li>â˜ åˆ é™¤é…ç½®æ–‡ä»¶</li>
<li>â˜ æ›´æ–°æ–‡æ¡£</li>
<li>â˜ ç›‘æ§ CI æ—¥å¿—ï¼ˆ48 å°æ—¶ï¼‰</li>
</ul>

<h3>ğŸ“ æ–‡æ¡£ç»´æŠ¤</h3>
<table>
<tr><th>æ–‡æ¡£</th><th>æœ€åæ›´æ–°</th><th>è¦†ç›–å†…å®¹</th></tr>
<tr><td>Dockeræ–¹æ¡ˆéƒ¨ç½²æŒ‡å—.md</td><td>2026-02-20</td><td>è¯¦ç»†éƒ¨ç½²ã€æ•…éšœæ’æŸ¥ã€æœ€ä½³å®è·µ</td></tr>
<tr><td>Dockerå¿«é€Ÿå‚è€ƒ.md</td><td>2026-02-20</td><td>å‘½ä»¤é€ŸæŸ¥ã€snippetsã€è¿›é˜¶æŠ€å·§</td></tr>
<tr><td>è¿ç§»æŒ‡å—-ä»è£¸æœºåˆ°Docker.md</td><td>2026-02-20</td><td>è¿ç§»ç­–ç•¥ã€åˆ†æ­¥æŒ‡å—ã€æ£€æŸ¥æ¸…å•</td></tr>
<tr><td>Docker_CIèµ„æºæ€»è§ˆ.md</td><td>2026-02-20</td><td>èµ„æºå¯¼èˆªã€ä½¿ç”¨åœºæ™¯ã€æœ€ä½³å®è·µ</td></tr>
</table>
</div>

<div class="footer">
<p style="margin-bottom: 10px;"><strong>Docker CI/CD å®Œæ•´æŒ‡å—æ•´åˆç‰ˆ</strong></p>
<p style="margin-bottom: 10px;">ç”±æ‰€æœ‰ç›¸å…³ Markdown æ–‡æ¡£æ•´åˆç”Ÿæˆ | åŒ…å«å…¨éƒ¨ 5 ä¸ª Docker ç›¸å…³æ–‡æ¡£çš„å®Œæ•´å†…å®¹</p>
<p style="margin-bottom: 10px;"><strong>ç‰ˆæœ¬</strong>: v1.0 | <strong>æ—¥æœŸ</strong>: 2026-02-20 | <strong>çŠ¶æ€</strong>: âœ… æ­£å¼ç‰ˆæœ¬</p>
<p>ğŸ’¾ ä¿å­˜æ­¤é¡µé¢æˆ–ä½¿ç”¨æµè§ˆå™¨æ‰“å°åŠŸèƒ½ç”Ÿæˆ PDF ç‰ˆæœ¬ | ğŸŒ æ¨èä½¿ç”¨ Chrome æˆ– Firefox æµè§ˆ</p>
</div>

</div>
</body>
</html>