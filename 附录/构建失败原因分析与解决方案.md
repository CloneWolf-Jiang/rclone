# GitHub Actions åœ¨ Rocky Linux ä¸Šçš„å®é™…é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

## ğŸ“‹ çœŸå®é—®é¢˜åˆ†æï¼ˆåŸºäºæ„å»ºæ—¥å¿—ï¼‰

### æ—¥å¿—å‘ç°ï¼ˆ2026-02-19T18:31:42ï¼‰

```
2026-02-19T18:31:42.6990512Z [36;1msudo modprobe fuse[0m
2026-02-19T18:31:42.6991443Z sudo chown root:$USER /etc/fuse.conf
2026-02-19T18:31:42.6991880Z sudo apt-get update
2026-02-19T18:31:42.6992658Z sudo apt-get install -y fuse3 libfuse-dev ...

2026-02-19T18:31:42.7208890Z sudo: è¯»å–å¯†ç éœ€è¦ä¸€ä¸ªç»ˆç«¯ï¼›è¯·ä½¿ç”¨ -S é€‰é¡¹ä»¥ä»æ ‡å‡†è¾“å…¥è¿›è¡Œè¯»å–ï¼Œæˆ–è€…é…ç½®ä¸€ä¸ª askpass åŠ©æ‰‹ç¨‹åº
2026-02-19T18:31:42.7217046Z sudo: éœ€è¦å¯†ç 
2026-02-19T18:31:42.7241491Z ##[error]Process completed with exit code 1.
```

### ğŸ”´ æ ¸å¿ƒé—®é¢˜

**runner ç”¨æˆ·æ‰§è¡Œ sudo å‘½ä»¤æ—¶éœ€è¦è¾“å…¥å¯†ç **ï¼Œåœ¨éäº¤äº’å¼ GitHub Actions ç¯å¢ƒä¸­æ— æ³•è¿›è¡Œã€‚

è¿™ä¸æ˜¯ apt-get çš„é—®é¢˜ï¼ˆè™½ç„¶ apt-get ä¹Ÿéœ€è¦å¤„ç†ï¼‰ï¼Œè€Œæ˜¯ **runner ç”¨æˆ·çš„ sudoers æƒé™é…ç½®ä¸æ­£ç¡®**ã€‚

---

## âœ… å®Œæ•´è§£å†³æ–¹æ¡ˆ

### é—®é¢˜ 1ï¼šsudo å…å¯†ç æƒé™ç¼ºå¤± ğŸ”´ é«˜ä¼˜å…ˆçº§

**åŸå› **ï¼šåœ¨ Rocky 9.4 ä¸Šéƒ¨ç½² GitHub Actions runner åï¼Œrunner ç”¨æˆ·æ²¡æœ‰è¢«é…ç½®ä¸º sudoers å…å¯†ç ç”¨æˆ·ã€‚

**è¡¨ç°**ï¼š
- `sudo modprobe fuse` â†’ âŒ `sudo: éœ€è¦å¯†ç `
- `sudo apt-get update` â†’ âŒ `sudo: éœ€è¦å¯†ç `

**è§£å†³æ–¹æ¡ˆ**ï¼š

é€šè¿‡è„šæœ¬è‡ªåŠ¨é…ç½®ï¼š
```bash
sudo bash setup-rocky-9.4-ci-env.sh
```

è„šæœ¬ä¼šè‡ªåŠ¨ï¼š
```bash
# 1. åˆ›å»º sudoers é…ç½®æ–‡ä»¶
echo "runner ALL=(ALL) NOPASSWD: ALL" | sudo tee /etc/sudoers.d/runner

# 2. è®¾ç½®æ­£ç¡®çš„æƒé™
chmod 0440 /etc/sudoers.d/runner

# 3. éªŒè¯é…ç½®
sudo -u runner sudo whoami  # åº”è¯¥è¾“å‡º "root"
```

å¦‚æœéœ€è¦æ‰‹åŠ¨ä¿®å¤ï¼Œè¿è¡Œï¼š
```bash
echo "runner ALL=(ALL) NOPASSWD: ALL" | sudo tee /etc/sudoers.d/runner
sudo chmod 0440 /etc/sudoers.d/runner
```

---

### é—®é¢˜ 2ï¼šapt-get å‘½ä»¤ä¸å­˜åœ¨ ğŸŸ¡ ä¸­ä¼˜å…ˆçº§

**åŸå› **ï¼šbuild.yml ä¸­ä½¿ç”¨äº† `apt-get` å‘½ä»¤ï¼ˆUbuntu ä¸“æœ‰ï¼‰ï¼Œä½† Rocky ä¸Šæ²¡æœ‰è¿™ä¸ªå‘½ä»¤ã€‚

**è¡¨ç°**ï¼š
- `sudo apt-get update` â†’ âŒ `apt-get: command not found`

**è§£å†³æ–¹æ¡ˆ**ï¼š

è„šæœ¬è‡ªåŠ¨åˆ›å»º apt-get wrapperï¼Œå°†æ‰€æœ‰ apt-get è°ƒç”¨è½¬æ¢ä¸º dnfï¼š

```bash
# è„šæœ¬åˆ›å»ºçš„ /usr/local/bin/apt-get wrapper
apt-get update       â†’ dnf clean all && dnf makecache -y
apt-get install -y   â†’ dnf install -y
apt-get remove       â†’ dnf remove -y
apt-get clean        â†’ dnf clean all -y
```

---

### é—®é¢˜ 3ï¼šç¼ºå°‘å¿…è¦çš„åº“ ğŸŸ¡ ä¸­ä¼˜å…ˆçº§

**åŸå› **ï¼šbuild.yml ä¸­éœ€è¦çš„åº“ï¼ˆfuse3ã€libfuse-devã€nfs-utils ç­‰ï¼‰åœ¨åŸºç¡€ Rocky å®‰è£…ä¸­ä¸å­˜åœ¨ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š

è„šæœ¬è‡ªåŠ¨å®‰è£…æ‰€æœ‰å¿…è¦çš„åº“ï¼š

```bash
# æ–‡ä»¶ç³»ç»Ÿå·¥å…·
btrfs-progs pigz util-linux lvm2 dosfstools parted e2fsprogs
fuse3 fuse-devel nfs-utils

# ç¼–è¯‘å·¥å…·
gcc g++ make binutils bison flex python3 python3-devel perl
openssl-devel libfdt-devel libncurses-devel zlib-devel glib2-devel

# ç‰ˆæœ¬æ§åˆ¶
git-annex
```

---

## ğŸš€ å®Œæ•´å®æ–½æ­¥éª¤

### ç¬¬ 1 æ­¥ï¼šç¡®ä¿ GitHub Actions Runner å·²éƒ¨ç½²

éƒ¨ç½² runner ç”¨æˆ·å’Œç›¸å…³ç›®å½•å­˜åœ¨ï¼š
```bash
# åº”è¯¥å­˜åœ¨è¿™äº›
ls -la /home/runner
id runner
```

### ç¬¬ 2 æ­¥ï¼šè¿è¡Œç¯å¢ƒåˆå§‹åŒ–è„šæœ¬

```bash
sudo bash setup-rocky-9.4-ci-env.sh
```

**è„šæœ¬æ‰§è¡Œæµç¨‹**ï¼š

```
1. ç³»ç»Ÿæ£€æŸ¥
   âœ“ æ£€æŸ¥ Rocky Linux ç‰ˆæœ¬
   âœ“ æ£€æŸ¥ç½‘ç»œè¿æ¥

2. æ›´æ–°åŒ…ç®¡ç†å™¨
   âœ“ dnf update

3. å®‰è£…åŸºç¡€å·¥å…·
   âœ“ git curl wget tar gzip...

4. å®‰è£…ç¼–è¯‘å·¥å…·
   âœ“ gcc g++ make bison flex...

5. å®‰è£…æ–‡ä»¶ç³»ç»Ÿå·¥å…·
   âœ“ btrfs-progs pigz fuse3 nfs-utils...

6. é…ç½® runner ç”¨æˆ·
   âœ“ æ·»åŠ åˆ° wheel ç»„
   âœ“ é…ç½® sudoers å…å¯†ç æƒé™ â† å…³é”®æ­¥éª¤
   âœ“ éªŒè¯ sudo é…ç½®

7. åˆ›å»º apt-get wrapper
   âœ“ åˆ›å»º /usr/local/bin/apt-get
   âœ“ è½¬æ¢æ‰€æœ‰ apt-get å‘½ä»¤

8. éªŒè¯æ‰€æœ‰å·¥å…·
   âœ“ æ£€æŸ¥å…³é”®å·¥å…·å¯ç”¨æ€§
   âœ“ æ˜¾ç¤ºç³»ç»Ÿä¿¡æ¯

9. æœ€ç»ˆç¡®è®¤
   âœ… ç³»ç»Ÿå·²å‡†å¤‡å¥½è¿è¡Œ GitHub Actions
```

### ç¬¬ 3 æ­¥ï¼šéªŒè¯é…ç½®

```bash
# éªŒè¯ sudo å…å¯†ç æƒé™
sudo -u runner sudo whoami
# è¾“å‡ºï¼šroot

# éªŒè¯ apt-get wrapper
apt-get --version
# è¾“å‡ºï¼šdnf version 4.21... æˆ–ç±»ä¼¼

# éªŒè¯å…³é”®å·¥å…·
gcc --version
make --version
git --version
btrfs --version
pigz --version
```

---

## ğŸ“Š æ„å»ºæµç¨‹ç°åœ¨åº”è¯¥å¦‚ä½•å·¥ä½œ

### GitHub Actions æ‰§è¡Œåºåˆ—ï¼ˆä¿®å¤åï¼‰

```
1. Checkout  âœ…
   è·å–ä»£ç 

2. Setup Go  âœ…
   å®‰è£… Go ç¼–è¯‘å™¨

3. Set environment variables  âœ…
   è®¾ç½®ç¯å¢ƒå˜é‡

4. Install Libraries on Linux  âœ… (ä¿®å¤ï¼)
   â””â”€ sudo modprobe fuse           âœ… (æœ‰ sudo æƒé™)
   â””â”€ sudo chmod 666 /dev/fuse     âœ… (æœ‰ sudo æƒé™)
   â””â”€ sudo chown root:$USER /etc/fuse.conf  âœ… (æœ‰ sudo æƒé™)
   â””â”€ sudo apt-get update          âœ… (é€šè¿‡ wrapper è½¬æ¢)
   â””â”€ sudo apt-get install -y ...  âœ… (é€šè¿‡ wrapper è½¬æ¢)

5. Print Go version  âœ…
6. Build rclone  âœ…
7. Run tests  âœ…
```

---

## ğŸ” æ•…éšœæ’æŸ¥

### ç—‡çŠ¶ 1ï¼šæ„å»ºä»ç„¶å¤±è´¥ï¼Œæ˜¾ç¤º "sudo: éœ€è¦å¯†ç "

**æ£€æŸ¥**ï¼š
```bash
# æ£€æŸ¥ sudoers é…ç½®
cat /etc/sudoers.d/runner

# åº”è¯¥æ˜¾ç¤º
# runner ALL=(ALL) NOPASSWD: ALL
```

**ä¿®å¤**ï¼š
```bash
echo "runner ALL=(ALL) NOPASSWD: ALL" | sudo tee /etc/sudoers.d/runner
sudo chmod 0440 /etc/sudoers.d/runner
```

### ç—‡çŠ¶ 2ï¼šapt-get ä»ç„¶æ‰¾ä¸åˆ°

**æ£€æŸ¥**ï¼š
```bash
which apt-get                      # åº”æ˜¾ç¤º /usr/local/bin/apt-get
ls -la /usr/local/bin/apt-get     # åº”è¯¥æ˜¯å¯æ‰§è¡Œçš„
apt-get --version                  # åº”è¯¥æ­£å¸¸è¾“å‡º
```

**ä¿®å¤**ï¼š
```bash
# é‡æ–°è¿è¡Œè„šæœ¬
sudo bash setup-rocky-9.4-ci-env.sh
```

### ç—‡çŠ¶ 3ï¼šæ„å»ºå¤±è´¥ï¼Œæ˜¾ç¤º "fuse3: command not found" æˆ–ç±»ä¼¼

**ä¿®å¤**ï¼š
```bash
# æ£€æŸ¥æ˜¯å¦å®‰è£…äº†å¿…è¦åº“
rpm -qa | grep fuse

# å¦‚æœæ²¡æœ‰å®‰è£…ï¼Œæ‰‹åŠ¨å®‰è£…
sudo dnf install -y fuse3 fuse-devel nfs-utils
```

---

## ğŸ“ éƒ¨ç½²æ¸…å•

éƒ¨ç½²å®Œæˆåï¼Œè¯·æ£€æŸ¥ä»¥ä¸‹é¡¹ç›®ï¼š

- [ ] Rocky Linux 9.4 ç³»ç»Ÿå·²å®‰è£…
- [ ] GitHub Actions Runner å·²éƒ¨ç½²ï¼ˆrunner ç”¨æˆ·å­˜åœ¨ï¼‰
- [ ] è¿è¡Œäº† `setup-rocky-9.4-ci-env.sh` è„šæœ¬
- [ ] è„šæœ¬è¾“å‡º "âœ… ç³»ç»Ÿå·²å®Œå…¨å‡†å¤‡å¥½è¿è¡Œ GitHub Actions!"
- [ ] `sudo -u runner sudo whoami` è¾“å‡º "root"ï¼ˆæ— å¯†ç æç¤ºï¼‰
- [ ] `/usr/local/bin/apt-get` å­˜åœ¨ä¸”å¯æ‰§è¡Œ
- [ ] `gcc --version`ã€`make --version` ç­‰å·¥å…·å¯ç”¨
- [ ] æµ‹è¯•æ„å»ºï¼šåœ¨ rclone ä»“åº“ä¸­æ‰‹åŠ¨è§¦å‘ GitHub Actions
- [ ] è§‚å¯Ÿ "Install Libraries on Linux" æ­¥éª¤æ˜¯å¦æˆåŠŸ

---

## ğŸ¯ æ€»ç»“

è¿™æ¬¡æ„å»ºå¤±è´¥çš„æ ¹æœ¬åŸå› æ˜¯ **runner ç”¨æˆ·çš„ sudoers æƒé™é…ç½®ä¸å®Œæ•´**ã€‚

è™½ç„¶å‘ç°äº† apt-get çš„å…¼å®¹æ€§é—®é¢˜ï¼Œä½†è§£å†³ sudo æƒé™é—®é¢˜æ‰æ˜¯è®©æ„å»ºæ­£å¸¸è¿è¡Œçš„å…³é”®ã€‚

è§£å†³æ–¹æ¡ˆï¼š**è¿è¡Œ `setup-rocky-9.4-ci-env.sh` è„šæœ¬ä¸€æ¬¡æ€§è§£å†³æ‰€æœ‰é—®é¢˜**ã€‚

---

**ç‰ˆæœ¬å†å²**
- v2.0 (2026-02-20): åŸºäºå®é™…æ„å»ºæ—¥å¿—çš„å®Œæ•´åˆ†æï¼Œç¡®è®¤æ ¸å¿ƒé—®é¢˜æ˜¯ sudo æƒé™
- v1.0 (2026-02-20): åˆå§‹ç‰ˆæœ¬ï¼ŒåŸºäºä»£ç åˆ†æ
